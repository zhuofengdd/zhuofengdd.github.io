<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Eureka的理解与深入</title>
      <link href="2021/03/31/eureka-de-li-jie-yu-shen-ru/"/>
      <url>2021/03/31/eureka-de-li-jie-yu-shen-ru/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><img src="1.png" alt></li><li><img src="2.png" alt></li></ul></blockquote><h2 id="分布式系统CAP定理"><a href="#分布式系统CAP定理" class="headerlink" title="分布式系统CAP定理"></a>分布式系统CAP定理</h2><blockquote><ul><li><img src="3.png" alt></li></ul></blockquote><h2 id="服务治理的技术与区别"><a href="#服务治理的技术与区别" class="headerlink" title="服务治理的技术与区别"></a>服务治理的技术与区别</h2><blockquote><ul><li><img src="4.png" alt></li><li><img src="5.png" alt></li></ul></blockquote><h2 id="创建服务注册中心"><a href="#创建服务注册中心" class="headerlink" title="创建服务注册中心"></a>创建服务注册中心</h2><blockquote><ul><li><img src="6.png" alt="改为pom类型"></li><li><img src="7.png" alt>  </li><li><img src="8.png" alt><br>创建module：eureka-server<br>引入依赖、改为jar类型<ul><li><img src="9.png" alt><br>创建启动类</li><li><img src="10.png" alt><br>配置文件改动：</li><li><img src="11.png" alt></li></ul></li><li><img src="12.png" alt><br>UI页面讲解</li></ul></blockquote><h2 id="注册服务提供方"><a href="#注册服务提供方" class="headerlink" title="注册服务提供方"></a>注册服务提供方</h2><blockquote><ul><li><img src="13.png" alt></li><li>module：eureka-client</li><li>添加依赖<ul><li><img src="14.png" alt></li></ul></li><li><img src="15.png" alt="启动类"></li><li><img src="16.png" alt="controller"></li><li><img src="17.png" alt="配置中心"></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微服务架构认知</title>
      <link href="2021/03/30/wei-fu-wu-jia-gou-ren-zhi/"/>
      <url>2021/03/30/wei-fu-wu-jia-gou-ren-zhi/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><img src="1.png" alt></li><li><img src="2.png" alt></li><li><img src="3.png" alt></li><li><img src="4.png" alt></li><li><img src="5.png" alt></li></ul></blockquote><h2 id="阿里新零售架构"><a href="#阿里新零售架构" class="headerlink" title="阿里新零售架构"></a>阿里新零售架构</h2><blockquote><ul><li><img src="6.png" alt></li><li><img src="7.png" alt></li><li><img src="8.png" alt></li><li><img src="9.png" alt></li><li><img src="10.png" alt></li><li><img src="11.png" alt></li><li><img src="12.png" alt></li></ul></blockquote><h2 id="spring-cloud"><a href="#spring-cloud" class="headerlink" title="spring cloud"></a>spring cloud</h2><blockquote><ul><li><img src="13.png" alt></li><li><img src="14.png" alt></li><li><img src="15.png" alt></li><li><img src="16.png" alt></li></ul></blockquote><h2 id="foodie微服务化思想"><a href="#foodie微服务化思想" class="headerlink" title="foodie微服务化思想"></a>foodie微服务化思想</h2><blockquote><ul><li><img src="17.png" alt></li><li><img src="18.png" alt></li><li><img src="19.png" alt></li><li><img src="20.png" alt></li><li><img src="21.png" alt></li><li><img src="22.png" alt></li><li><img src="23.png" alt></li><li><img src="24.png" alt></li><li><img src="25.png" alt></li><li><img src="26.png" alt></li><li><img src="27.png" alt></li></ul></blockquote><blockquote><p>想到知识点随时补充，欢迎小伙伴们常点击。<br><strong>有喜欢的小伙伴可以多多分享哦</strong><br><strong>欢迎打赏！！！</strong></p></blockquote><p><em>本系列均为原创，如有引用请注明出处，如以本内容获取盈利，本人有法律权益进行相关维权！！</em></p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十分钟了解分布式限流</title>
      <link href="2021/03/30/shi-fen-zhong-liao-jie-fen-bu-shi-xian-liu/"/>
      <url>2021/03/30/shi-fen-zhong-liao-jie-fen-bu-shi-xian-liu/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><img src="1.png" alt></li><li><img src="2.png" alt></li><li><img src="3.png" alt></li></ul></blockquote><h2 id="guava-RateLimiter客户端限流"><a href="#guava-RateLimiter客户端限流" class="headerlink" title="guava RateLimiter客户端限流"></a>guava RateLimiter客户端限流</h2><blockquote><p><em>（不是分布式，只在当前服务器起作用）</em></p><ul><li><img src="4.png" alt></li><li>创建module：rate-limiter</li><li>添加依赖：springbootstarterweb、guava</li><li>创造包、启动类、main入口<ul><li><img src="5.png" alt></li></ul></li><li>配置文件<ul><li><img src="6.png" alt></li></ul></li><li>创建controller<ul><li>创建RateLimiter对象</li><li>非阻塞限流方法</li><li><img src="7.png" alt></li><li>限时非阻塞方法(有fast-fail机制)</li><li><img src="8.png" alt></li><li>同步阻塞式限流</li><li><img src="9.png" alt></li></ul></li></ul></blockquote><h2 id="基于nginx的ip限流"><a href="#基于nginx的ip限流" class="headerlink" title="基于nginx的ip限流"></a>基于nginx的ip限流</h2><blockquote><ul><li><img src="10.png" alt><ul><li>创建方法 </li><li>nginx配置</li><li><img src="11.png" alt> </li><li><img src="12.png" alt></li><li><code>sudo /usr/local/nginx/sbin/nginx -s reload</code></li><li><img src="13.png" alt></li></ul></li></ul></blockquote><h2 id="基于服务器级别限制"><a href="#基于服务器级别限制" class="headerlink" title="基于服务器级别限制"></a>基于服务器级别限制</h2><blockquote><ul><li><img src="14.png" alt><ul><li><img src="15.png" alt></li><li><img src="16.png" alt></li></ul></li></ul></blockquote><h2 id="基于连接数级别限制"><a href="#基于连接数级别限制" class="headerlink" title="基于连接数级别限制"></a>基于连接数级别限制</h2><blockquote><ul><li><img src="17.png" alt></li><li><img src="18.png" alt></li><li><img src="19.png" alt="限制下载速度"></li></ul></blockquote><h2 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h2><blockquote><ul><li>脚本语言</li><li><img src="20.png" alt></li><li><img src="21.png" alt></li><li><img src="22.png" alt></li><li><img src="23.png" alt></li><li><img src="24.png" alt="hello lua"></li><li><img src="25.png" alt="假的限流脚本"></li></ul></blockquote><h2 id="Redis预加载Lua"><a href="#Redis预加载Lua" class="headerlink" title="Redis预加载Lua"></a>Redis预加载Lua</h2><blockquote><ul><li><img src="26.png" alt></li><li>启动redis——&gt;./redis-server—–&gt;./redis-cli</li><li><code>eval</code>就代表lua编写<ul><li><img src="27.png" alt></li><li><img src="28.png" alt></li><li><img src="29.png" alt></li><li><img src="30.png" alt="查看是否存在"></li><li><img src="31.png" alt="清空缓存"></li></ul></li></ul></blockquote><h2 id="限流组件封装Redis-Lua"><a href="#限流组件封装Redis-Lua" class="headerlink" title="限流组件封装Redis+Lua"></a>限流组件封装Redis+Lua</h2><blockquote><ul><li><img src="32.png" alt></li><li>创建module项目作为注解使用ratelimiter-annotation</li><li>改打包方式为jar</li><li>引入maven依赖，spingbootstarter-data-redis、springbootstarteraop、guava</li><li>建包</li><li>创建类AccessLimiter<ul><li><img src="33.png" alt></li><li><img src="34.png" alt> </li></ul></li><li>添加要使用的bean<ul><li><img src="35.png" alt></li></ul></li><li>lua脚本<ul><li><img src="36.png" alt></li><li><img src="37.png" alt></li></ul></li></ul></blockquote><blockquote><ul><li>创建新项目</li><li>添加依赖、springbootstarterweb、以及编写的ratelimiter-annotation</li><li>启动类、controller</li><li>注入AccessLimiter，对应包的类名   </li><li>配置文件：<ul><li><img src="38.png" alt></li></ul></li><li>浏览器访问即可，已经实现限流</li></ul></blockquote><blockquote><p>配置为注解<br><img src="39.png" alt><br>对应包下新建annotation包和注解类</p><ul><li><img src="40.png" alt><br>创建切面类AccessLimiterAspect</li><li><img src="41.png" alt></li><li><img src="42.png" alt>  </li><li><img src="43.png" alt></li><li><img src="44.png" alt></li><li>测试方法：成功</li><li><img src="45.png" alt></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十分钟了解接口幂等性</title>
      <link href="2021/03/30/shi-fen-zhong-liao-jie-jie-kou-mi-deng-xing/"/>
      <url>2021/03/30/shi-fen-zhong-liao-jie-jie-kou-mi-deng-xing/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><img src="1.png" alt></li><li><img src="2.png" alt></li><li><img src="3.png" alt></li><li><img src="4.png" alt></li><li><img src="5.png" alt></li><li><img src="6.png" alt></li><li><img src="7.png" alt></li><li><img src="8.png" alt></li></ul></blockquote><h2 id="Update操作幂等性"><a href="#Update操作幂等性" class="headerlink" title="Update操作幂等性"></a>Update操作幂等性</h2><blockquote><ul><li><img src="9.png" alt></li><li><img src="10.png" alt></li><li><img src="11.png" alt></li></ul></blockquote><h2 id="Insert操作幂等性"><a href="#Insert操作幂等性" class="headerlink" title="Insert操作幂等性"></a>Insert操作幂等性</h2><blockquote><ul><li><img src="12.png" alt></li><li><img src="13.png" alt></li><li><img src="14.png" alt></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十分钟了解分布式事务</title>
      <link href="2021/03/30/shi-fen-zhong-liao-jie-fen-bu-shi-shi-wu/"/>
      <url>2021/03/30/shi-fen-zhong-liao-jie-fen-bu-shi-shi-wu/</url>
      
        <content type="html"><![CDATA[<p>为什么需要分布式事务？</p><blockquote><p>在传统数据库中满足ACID四个属性，是没有问题的。<br>但当分库分表后，操作AB数据库，想保证数据统一是比较难的。<br>本章将介绍CAP原理、ACID原理以及BASE原理。<br>基于XA协议的两阶段提交（不提倡使用，容易导致数据库挂起状态）<br>事务补偿机制（回滚接口）<br>基于本地消息表的最终一致方案<br>基于MQ消息队列的最终一致方案</p></blockquote><h2 id="1-分布式事务问题"><a href="#1-分布式事务问题" class="headerlink" title="1 分布式事务问题"></a>1 分布式事务问题</h2><blockquote><p>传统数据库使用</p><ul><li><img src="1.png" alt></li><li><img src="2.png" alt><br>分布式系统（A、B用户落在不同数据库，A向B转钱，如果出问题无法同步）</li><li><img src="3.png" alt></li><li><img src="4.png" alt></li><li><img src="5.png" alt></li></ul></blockquote><h2 id="2-基于XA协议的两阶段提交"><a href="#2-基于XA协议的两阶段提交" class="headerlink" title="2 基于XA协议的两阶段提交"></a>2 基于XA协议的两阶段提交</h2><h3 id="2-1原理"><a href="#2-1原理" class="headerlink" title="2.1原理"></a>2.1原理</h3><blockquote><ul><li><img src="6.png" alt> </li><li><img src="7.png" alt></li><li><img src="8.png" alt></li><li><img src="9.png" alt="Atomikos为事务管理器"></li></ul></blockquote><h3 id="2-2-实际操作："><a href="#2-2-实际操作：" class="headerlink" title="2.2 实际操作："></a>2.2 实际操作：</h3><blockquote><ul><li>创建工程springboot</li><li>引入jar包<ul><li><img src="10.png" alt></li></ul></li><li>创建config包，建立两个对应不同数据库的数据源注入<ul><li><img src="11.png" alt></li><li><img src="12.png" alt="生成对应sqlSessionFactoryBean"></li><li><img src="13.png" alt="类头注解，扫描包，一个数据源直接配置在启动类，当配置多个，就得分别加"></li><li><img src="14.png" alt="配置事务管理器"></li><li>132 同理</li></ul></li><li>mybatisGenerator生成两个mapper文件</li><li>创建service进行插入语句编写</li><li><img src="15.png" alt="使用resource注解，autowird注解会有红线"></li><li>使用测试类进行测试：当一个数据库插入操作发生异常时，会统一回滚，运行正常！</li></ul></blockquote><h3 id="2-3-基于mycat的xa协议设置"><a href="#2-3-基于mycat的xa协议设置" class="headerlink" title="2.3 基于mycat的xa协议设置"></a>2.3 基于mycat的xa协议设置</h3><blockquote><ul><li>配置server.xml中的handleDistributedTransactions对应标签</li><li><img src="16.png" alt></li></ul></blockquote><blockquote><ul><li><img src="17.png" alt="关闭自动提交，开启xa "></li><li><img src="18.png" alt="在项目中直接连接mycat，就支持分布式事务"></li></ul></blockquote><h3 id="2-4-基于sharding-JDBC的xa协议设置"><a href="#2-4-基于sharding-JDBC的xa协议设置" class="headerlink" title="2.4 基于sharding-JDBC的xa协议设置"></a>2.4 基于sharding-JDBC的xa协议设置</h3><blockquote><ul><li><img src="19.png" alt="默认开启。不用管"></li></ul></blockquote><h2 id="3-事务补偿机制"><a href="#3-事务补偿机制" class="headerlink" title="3 事务补偿机制"></a>3 事务补偿机制</h2><blockquote><ul><li><img src="20.png" alt></li><li><img src="21.png" alt></li><li><img src="23.png" alt></li><li><img src="24.png" alt="补偿也有可能出错"></li><li><img src="25.png" alt></li></ul></blockquote><h2 id="基于本地方法表"><a href="#基于本地方法表" class="headerlink" title="基于本地方法表"></a>基于本地方法表</h2><blockquote><ul><li><img src="26.png" alt></li><li><img src="27.png" alt></li><li><img src="28.png" alt></li><li><img src="30.png" alt></li><li><img src="29.png" alt></li><li><img src="31.png" alt></li><li><img src="32.png" alt></li></ul></blockquote><h2 id="基于MQ的最终一致方案"><a href="#基于MQ的最终一致方案" class="headerlink" title="基于MQ的最终一致方案"></a>基于MQ的最终一致方案</h2><blockquote><ul><li><img src="33.png" alt></li><li><img src="34.png" alt></li><li><img src="35.png" alt></li></ul></blockquote><blockquote><p>想到知识点随时补充，欢迎小伙伴们常点击。<br><strong>有喜欢的小伙伴可以多多分享哦</strong><br><strong>欢迎打赏！！！</strong></p></blockquote><p><em>本系列均为原创，如有引用请注明出处，如以本内容获取盈利，本人有法律权益进行相关维权！！</em></p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十分钟了解分布式全局id</title>
      <link href="2021/03/29/shi-fen-zhong-liao-jie-fen-bu-shi-quan-ju-id/"/>
      <url>2021/03/29/shi-fen-zhong-liao-jie-fen-bu-shi-quan-ju-id/</url>
      
        <content type="html"><![CDATA[<blockquote><p><img src="1.png" alt><br><img src="2.png" alt></p></blockquote><h1 id="1-分库分表引发的id问题"><a href="#1-分库分表引发的id问题" class="headerlink" title="1 分库分表引发的id问题"></a>1 分库分表引发的id问题</h1><ul><li><p>每张表都有唯一标识，通常使用id</p></li><li><p>id通常采用自增的方式</p></li><li><p>分库分表情况下，每张表id从0开始自增</p></li><li><p>不同的分片上。id可能重复——&gt;id不唯一<br><img src="3.png" alt></p><h1 id="2-UUID"><a href="#2-UUID" class="headerlink" title="2 UUID"></a>2 UUID</h1><blockquote><p>UUID–&gt;通用唯一识别码<br>使用UUID，可保证每一条记录的id不同</p></blockquote></li></ul><p><strong>缺点：</strong>只是单纯id，无意义，长度32位过长</p><blockquote><p>MyCat不支持UUID，sharding JDBC支持UUID</p></blockquote><blockquote><ul><li>sharding-JDBC使用UUID</li><li>配置中application.proporties对shardingJDBC的配置追加两行：<ul><li><img src="4.png" alt></li></ul></li><li>设定对应列与key生成策略</li><li><img src="5.png" alt="测试"><br>如果使用UUID生成的列进行分片策略配置，则不能使用行内表达式<br>且要进行自定义分片策略：<ul><li><img src="6.png" alt="这里需要重写方法，从而获取生成的UUID"></li><li><img src="7.png" alt></li></ul></li></ul></blockquote><h1 id="3-统一ID序列"><a href="#3-统一ID序列" class="headerlink" title="3 统一ID序列"></a>3 统一ID序列</h1><blockquote><p>ID的值统一从一个集中的ID生成器中获取，避免重复<br><img src="8.png" alt><br>MyCat支持Id序列生成，shardingJDBC不支持<br>两种方式：<strong>本地文件方式</strong>和<strong>数据库方式</strong></p><ul><li>测试环境：本地文件形式</li><li>上线后：数据库模式</li><li>优点：ID集中管理，避免重复</li><li>缺点:并发量大时，数据库压力大</li></ul></blockquote><h2 id="3-1-本地文件方式"><a href="#3-1-本地文件方式" class="headerlink" title="3.1 本地文件方式"></a>3.1 本地文件方式</h2><blockquote><p>使用131与132进行演示</p><ul><li>在130的mycat上更改server.xml<ul><li><img src="9.png" alt></li></ul></li><li>sequence_conf.proporties<ul><li><img src="10.png" alt></li></ul></li><li>改完后在130的mycat命令行界面键入：(后缀名与上述文件中配置、表名一致)</li><li><img src="12.png" alt></li><li>在插入数据时 报错：mycat的bug—–&gt;解决方法如下图：<ul><li><img src="11.png" alt></li><li>改完配置要reload @@config；</li></ul></li><li>重新运行sql语句就可以了<br>当不想给语句中写id时，可以在schema.xml进行修改<ul><li><blockquote><p><img src="13.png" alt></p></blockquote></li></ul></li></ul></blockquote><h2 id="3-2-数据库方式"><a href="#3-2-数据库方式" class="headerlink" title="3.2 数据库方式"></a>3.2 数据库方式</h2><blockquote><ul><li>首先改序列方式<ul><li><img src="14.png" alt></li></ul></li><li>数据库中建表，只能选择一个节点</li><li>其中根目录的dbseq.sql为对应脚本，使用命令<code>sz dbseq.sql</code></li><li>在131的数据库执行，生成MYCAT_SEQUENCE表和对应函数<ul><li><img src="15.png" alt="表"></li><li><img src="16.png" alt="函数"></li><li><img src="17.png" alt="在表中添加序列"></li><li>配置sequence_db_conf.proporties</li><li><img src="18.png" alt></li><li><code>./bin/mycat restart</code>重启一下</li></ul></li></ul></blockquote><h1 id="4-雪花算法"><a href="#4-雪花算法" class="headerlink" title="4 雪花算法"></a>4 雪花算法</h1><blockquote><p>由推特提出的关于分布式id算法<br>64bit的long类型<br>引入时间戳，保证递增<br>64bit组成分别为：</p><ul><li><img src="19.png" alt><ul><li><img src="20.png" alt><br>如何使用：</li></ul></li></ul></blockquote><h2 id="4-1-mycat配置"><a href="#4-1-mycat配置" class="headerlink" title="4.1 mycat配置"></a>4.1 mycat配置</h2><blockquote><p>mycat端对配置文件进行更改</p><ul><li><img src="21.png" alt></li><li><code>insert into o_order(total_amount,order_status)values(444,2)</code></li><li>对分片规则进行设定，雪花算法分配的id较大，尽量别使用默认分片规则，可使用mod取余规则</li><li>reload @@config</li><li>成功进行id生成</li></ul></blockquote><blockquote><p><code>vim conf/sequence_time_conf.proporties</code>配置了数据中心和workID<br>当部署多台时，可在此配置文件中进行添加<br><img src="22.png" alt="此两个参数只能设置为小于32的数"></p></blockquote><h2 id="4-2-sharding-JDBC配置"><a href="#4-2-sharding-JDBC配置" class="headerlink" title="4.2 sharding-JDBC配置"></a>4.2 sharding-JDBC配置</h2><h3 id="4-2-1-xml文件配置方法"><a href="#4-2-1-xml文件配置方法" class="headerlink" title="4.2.1 xml文件配置方法"></a>4.2.1 xml文件配置方法</h3><blockquote><p><img src="23.png" alt><br>使用标准分片规则，在重写的接口中进行取模规则设定<br><img src="24.png" alt="重写规则策略"><br>生成id成功</p></blockquote><h3 id="4-3-3-springboot配置方法"><a href="#4-3-3-springboot配置方法" class="headerlink" title="4.3.3 springboot配置方法"></a>4.3.3 springboot配置方法</h3><blockquote><p>改application.properties<br><img src="25.png" alt></p></blockquote><blockquote><p>想到知识点随时补充，欢迎小伙伴们常点击。<br><strong>有喜欢的小伙伴可以多多分享哦</strong><br><strong>欢迎打赏！！！</strong></p></blockquote><p><em>本系列均为原创，如有引用请注明出处，如以本内容获取盈利，本人有法律权益进行相关维权！！</em></p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于sharding jdbc的分库分表与读写分离</title>
      <link href="2021/03/29/ji-yu-sharding-jdbc-de-fen-ku-fen-biao-yu-du-xie-fen-chi/"/>
      <url>2021/03/29/ji-yu-sharding-jdbc-de-fen-ku-fen-biao-yu-du-xie-fen-chi/</url>
      
        <content type="html"><![CDATA[<h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h2><blockquote><ul><li>sharding JDBC区别于MYcat，是基于客户端的代理模式</li><li>只能由java语言使用</li><li><img src="1.png" alt></li><li><img src="2.png" alt></li><li><img src="3.png" alt></li><li>业务全部通过sharding-JDBC进行数据库的连接</li><li>注册中心可以使用zookeeper</li><li><img src="4.png" alt></li><li>与mycat区别：<ul><li><img src="5.png" alt></li></ul></li></ul></blockquote><h2 id="2-sharding-JDBC的使用"><a href="#2-sharding-JDBC的使用" class="headerlink" title="2 sharding-JDBC的使用"></a>2 sharding-JDBC的使用</h2><blockquote><p><strong>官方网站：</strong> <a href="https://shardingsphere.apache.org" target="_blank" rel="noopener">shardingsphere.apache.org</a></p></blockquote><h3 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2.1 概念"></a>2.1 概念</h3><blockquote><ul><li>逻辑表</li><li>真实表</li><li>数据节点</li><li>绑定表（类似于mycat的子表）</li><li>广播表（全局表）</li></ul></blockquote><h3 id="2-2-建库"><a href="#2-2-建库" class="headerlink" title="2.2 建库"></a>2.2 建库</h3><blockquote><ul><li>针对于131、132两个虚拟机</li><li><img src="6.png" alt="shard_order"></li><li>复制两份t_order1、t_order2(sharding-JDBC支持一个数据库分片)</li><li><strong>实现功能：</strong>先使用user_id进行数据库的分片，在使用id进行数据表的分片</li><li>使用mybatis-generator进行文件生成</li></ul></blockquote><h3 id="2-3-xml配置"><a href="#2-3-xml配置" class="headerlink" title="2.3 xml配置"></a>2.3 xml配置</h3><blockquote><ul><li>引入maven依赖</li><li><img src="7.png" alt></li><li>xml文件加入命名空间</li><li>数据源配置(两个)<ul><li><img src="8.png" alt></li></ul></li><li>sharding的datasource<ul><li><img src="9.png" alt="先配置数据库分片规则"></li><li><img src="10.png" alt="配置表的分片规则"></li><li><img src="11.png" alt="sharding:data-source配置"></li></ul></li><li>mybatis的sqlSessionFactory<ul><li><img src="12.png" alt></li></ul></li><li>把mapper.xml中所有t_order1替换为t_order逻辑表</li><li>启动类引入xml文件、扫描包<ul><li><img src="13.png" alt></li><li><img src="16.png" alt></li></ul></li><li>测试<ul><li>注入ordermapper</li><li><img src="14.png" alt></li><li><img src="15.png" alt></li></ul></li></ul></blockquote><h2 id="2-4-springboot使用"><a href="#2-4-springboot使用" class="headerlink" title="2.4 springboot使用"></a>2.4 springboot使用</h2><blockquote><ul><li>引用maven包</li><li><img src="17.png" alt></li><li>applition.proporities配置<ul><li><img src="18.png" alt="数据源"></li><li><img src="19.png" alt="分片策略"></li><li><img src="20.png" alt="mybatis"></li></ul></li><li>测试<ul><li>同上—-成功</li><li><img src="21.png" alt></li></ul></li></ul></blockquote><h2 id="3-全局（广播表）"><a href="#3-全局（广播表）" class="headerlink" title="3 全局（广播表）"></a>3 全局（广播表）</h2><blockquote><ul><li>建表</li><li>applition.proporties配置</li><li><img src="22.png" alt></li><li>测试</li></ul></blockquote><h2 id="4-子表（绑定表）"><a href="#4-子表（绑定表）" class="headerlink" title="4 子表（绑定表）"></a>4 子表（绑定表）</h2><blockquote><ul><li>避免跨库查询</li><li>创建关联表<br>……</li></ul></blockquote><blockquote><p>想到知识点随时补充，欢迎小伙伴们常点击。<br><strong>有喜欢的小伙伴可以多多分享哦</strong><br><strong>欢迎打赏！！！</strong></p></blockquote><p><em>本系列均为原创，如有引用请注明出处，如以本内容获取盈利，本人有法律权益进行相关维权！！</em></p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分库分表的原理及技术介绍</title>
      <link href="2021/03/29/fen-ku-fen-biao-yu-du-xie-fen-chi-de-yuan-li-ji-ji-yu-mycat-de-ji-zhu-jie-shao/"/>
      <url>2021/03/29/fen-ku-fen-biao-yu-du-xie-fen-chi-de-yuan-li-ji-ji-yu-mycat-de-ji-zhu-jie-shao/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在部署分布式集群后，每个节点的请求落到的tomcat服务器是不一样的，单体锁不能保证服务的可靠性，因此需要读写分离、分库分表</p></blockquote><blockquote><p>读多写少如何解决？  –读库写库分别部署<br>海量数据？  –数据切分（垂直切分、水平切分）</p></blockquote><h2 id="1-数据切分"><a href="#1-数据切分" class="headerlink" title="1 数据切分"></a>1 数据切分</h2><blockquote><ul><li><strong>垂直切分</strong><br><img src="3.png" alt><br><img src="4.png" alt><br><img src="5.png" alt><br><img src="6.png" alt><ul><li>跨库消耗性能</li></ul></li><li><strong>水平切分</strong><br><img src="7.png" alt><br><img src="8.png" alt><br><img src="9.png" alt><br><img src="10.png" alt><br>实际中，通常先垂直后水平</li></ul></blockquote><h2 id="2-实现读写分离和数据切分的方式"><a href="#2-实现读写分离和数据切分的方式" class="headerlink" title="2 实现读写分离和数据切分的方式"></a>2 实现读写分离和数据切分的方式</h2><ul><li>中间代理（MyCat）<br><img src="1.png" alt="中间代理"></li><li>客户端模式（sharding-jdbc）<br><img src="2.png" alt="客户端模式"></li></ul><h2 id="3-MyCat环境搭建"><a href="#3-MyCat环境搭建" class="headerlink" title="3 MyCat环境搭建"></a>3 MyCat环境搭建</h2><blockquote><p><img src="11.png" alt><br><img src="12.png" alt><br><img src="13.png" alt><br><img src="14.png" alt></p></blockquote><h3 id="3-1-mysql安装："><a href="#3-1-mysql安装：" class="headerlink" title="3.1 mysql安装："></a>3.1 mysql安装：</h3><blockquote><ul><li>安装yum仓库    //在官网找对应的步骤，很全面</li><li>仓库传到131与132虚拟机上 /opt/      //rz命令 可以传文件</li><li><code>yum -y install lrzsz</code></li><li><img src="15.png" alt></li><li><code>yum install mysql-community--server</code></li><li><code>service start mysql</code>启动</li><li><code>grep &#39;temporary password&#39; /var/log/mysqld.log</code>查看临时密码</li><li>登录</li><li>修改密码</li><li><img src="16.png" alt></li><li>创建用户，使用老的加密方式，mysql8使用了新的加密方式，不这么写，不然navicat连不上</li><li>授权</li><li><img src="17.png" alt></li></ul></blockquote><h3 id="3-2-MyCat安装"><a href="#3-2-MyCat安装" class="headerlink" title="3.2 MyCat安装"></a>3.2 MyCat安装</h3><blockquote><ul><li>mycat.io官网下载压缩包</li><li>/opt、目录下   rz命令上传</li><li>tar -zxvf 解压</li><li>修改配置文件</li></ul></blockquote><h4 id="3-2-1-server-xml"><a href="#3-2-1-server-xml" class="headerlink" title="3.2.1 server.xml"></a>3.2.1 server.xml</h4><blockquote><ul><li><img src="18.png" alt></li><li>用户和数据库</li></ul></blockquote><h4 id="3-2-2-schema-xml"><a href="#3-2-2-schema-xml" class="headerlink" title="3.2.2 schema.xml"></a>3.2.2 schema.xml</h4><blockquote><ul><li>配置dataHost——dataNode——–schema</li><li><img src="19.png" alt></li><li>配置131和132</li><li><img src="20.png" alt></li><li><img src="21.png" alt></li><li>此处的user和server.xml里的也要对应</li><li>在两个tomcat里创建对应数据库与表，一定要对应 </li><li>这里分片的规则默认为auto-sharding-long   对应了rule.xml里的配置</li><li>每种规则对应一个映射txt文件，里面包含了分片具体设定</li><li><img src="22.png" alt></li></ul></blockquote><h4 id="3-2-3-启动"><a href="#3-2-3-启动" class="headerlink" title="3.2.3 启动"></a>3.2.3 启动</h4><blockquote><ul><li>./bin/mycat console     //打印日志在服务台</li><li>navicat连接</li><li><img src="23.png" alt><br>插入一条数据，对应的分片tomcat也会同步数据，分片规则以id为根据，配置详情在&gt;txt文件里。</li></ul></blockquote><h3 id="3-3-server-xml详细配置"><a href="#3-3-server-xml详细配置" class="headerlink" title="3.3 server.xml详细配置"></a>3.3 server.xml详细配置</h3><blockquote><ul><li><img src="24.png" alt></li><li><img src="25.png" alt></li><li>/opt目录下server.xml，schema标签要和schema.xml里的schema标签相对应</li><li>MyCat使用的也是老的加密方式，</li><li><img src="26.png" alt></li><li>使用mysql客户端命令行连接应指定老的加密方式</li><li><code>mysql -uroot -p -P8066 -h127.0.0.1 --default-auth=mysql_native_password</code>这样就可以连接了</li></ul></blockquote><h3 id="3-4-schema-xml详细配置"><a href="#3-4-schema-xml详细配置" class="headerlink" title="3.4 schema.xml详细配置"></a>3.4 schema.xml详细配置</h3><blockquote><ul><li><img src="27.png" alt></li><li><img src="28.png" alt></li><li>dataHost着重看两个参数  writeType与balance</li><li><img src="29.png" alt></li><li>sqlMaxLimit：可以进行限制条数</li><li><img src="30.png" alt></li><li><img src="31.png" alt></li><li><img src="32.png" alt><br>mycat启动有两个端口，8066和9066，都可以用navicat进行连接，可以在9066端口里<code>show @@help</code><br><code>reload @@config</code>可以在配置文件更改后不重启服务的情况下进行配置更新</li></ul></blockquote><h3 id="3-5-rule-xml详细配置"><a href="#3-5-rule-xml详细配置" class="headerlink" title="3.5 rule.xml详细配置"></a>3.5 rule.xml详细配置</h3><blockquote><ul><li>配置分片规则tablerule标签对应了分片规则，function标签   对应了txt文件</li><li>txt文件中可以进行分片的具体设定</li><li>mycat的分片规则可以在文档中查看，比如：分片枚举，可以根据固定的值进行分库</li><li>以分片枚举为例：<ul><li><img src="40.png" alt></li><li><img src="41.png" alt></li><li><img src="42.png" alt></li><li><img src="43.png" alt></li><li><img src="44.png" alt></li></ul></li><li>mycat添加字段，修改会同步到所有子节点上。</li><li>根据province_id进行分片,根据枚举值进行分片，非枚举值插入默认节点</li><li>每次改配置文件后要在9066端口进行reload @@config</li><li>取模规则（常用）<ul><li><img src="45.png" alt></li><li><img src="46.png" alt></li></ul></li></ul></blockquote><h2 id="4-Mycat配置实操"><a href="#4-Mycat配置实操" class="headerlink" title="4 Mycat配置实操"></a>4 Mycat配置实操</h2><h3 id="4-1-mycat层面读写分离"><a href="#4-1-mycat层面读写分离" class="headerlink" title="4.1 mycat层面读写分离"></a>4.1 mycat层面读写分离</h3><blockquote><ul><li>读写分离配置，主从的数据库名称也要一致。读和写</li><li>这里的配置不涉及同步，同步后面讲解</li><li>如果修改的是数据源，要在9066端口<code>reload @@config_all</code>，此操作较慢</li><li><img src="33.png" alt></li><li>分别测试balance为0（只在写库）、1（读请求进行读写库切换，主要针对双主双从，主互为主备的情况，这种况M2.S1.S2会参与负载均衡，M1不会）、2（所有读操作随机分配在读库和写库上）、3（所有读请求分配到读库上，写库不会有读请求压力）</li><li>测试writeType 分别为0（默认为0，表示插入操作时插入在第一个写库，如果此库挂了<code>system stop mysqld</code>，则插入顺序往下的第一个写库,重新启动后的写库排在队列末尾）、1（） </li></ul></blockquote><h3 id="4-2-mysql层面读写分离"><a href="#4-2-mysql层面读写分离" class="headerlink" title="4.2 mysql层面读写分离"></a>4.2 mysql层面读写分离</h3><h4 id="4-2-1"><a href="#4-2-1" class="headerlink" title="4.2.1"></a>4.2.1</h4><blockquote><ul><li>这里的主从配置可以实现数据同步</li><li><img src="35.png" alt></li><li>主<ul><li><code>vim /etc/my.cnf</code></li><li>配置log-bin与server-id</li></ul></li><li>从<ul><li>配置server-id</li><li>service restart mysql</li></ul></li></ul></blockquote><h4 id="4-2-2"><a href="#4-2-2" class="headerlink" title="4.2.2"></a>4.2.2</h4><blockquote><ul><li><img src="36.png" alt></li><li>主创建授权账号——开启mysql——创建用户（用默认加密方式就可）—授权</li><li><img src="37.png" alt></li><li>主进行锁表(此时向主插入会失败，卡住)<ul><li><code>flush tables with read lock;</code></li><li><img src="38.png" alt>记住文件名称和位置</li><li>dump文件复制到从机，使用scp命令</li></ul></li><li>从机<ul><li><code>scp root@192.168.73.131:~/dbdump.db .</code>在输入机器密码即可复制到当前目录</li><li>从机<code>mysql &lt; dbdump.db -uroot -p</code></li></ul></li><li>主 <code>unlock tables</code></li></ul></blockquote><h4 id="4-2-3"><a href="#4-2-3" class="headerlink" title="4.2.3"></a>4.2.3</h4><blockquote><ul><li>从机中配置主机，在mysql中</li><li><img src="39.png" alt>，</li><li>输入主机ip，主从同步的用户user，密码，文件名，位置,内容单引号包裹</li><li><code>start slave;</code></li></ul><p><em>这样配置后，mysql的主从便搭建好了，通过MyCat层面和mysql层面的配置，便可实现同步的读写分离</em> </p></blockquote><h2 id="5-全局表与子表"><a href="#5-全局表与子表" class="headerlink" title="5 全局表与子表"></a>5 全局表与子表</h2><h3 id="5-1-全局表"><a href="#5-1-全局表" class="headerlink" title="5.1 全局表"></a>5.1 全局表</h3><blockquote><p>比如一些不变的东西，省市区之类的数据经常会用来关联查询，所以常设置为全局表<br><img src="47.png" alt></p></blockquote><h3 id="5-2-子表"><a href="#5-2-子表" class="headerlink" title="5.2 子表"></a>5.2 子表</h3><blockquote><p>比如订单使用order_id取模，订单详情与商品信息也进行分片，想查询一个订单的所有信息，有可能因所在主机不同而不成功。跨库操作。这样的话就需要子表，保证两者在一个主机上。<br><img src="48.png" alt><br><img src="49.png" alt></p><ul><li>建库建表</li><li><img src="50.png" alt></li><li>这样子表会对应父表进行分片，防止跨库操作。</li></ul></blockquote><h2 id="6-MyCat的HA"><a href="#6-MyCat的HA" class="headerlink" title="6 MyCat的HA"></a>6 MyCat的HA</h2><h3 id="6-1-原理"><a href="#6-1-原理" class="headerlink" title="6.1 原理"></a>6.1 原理</h3><blockquote><ul><li>保证一个节点挂了也不影响使用</li><li><img src="51.png" alt></li><li><img src="52.png" alt></li><li><img src="53.png" alt></li><li>Haproxy用作负载均衡，区别于Nginx（<strong>基于http</strong>请求），haproxy为<strong>tcp层的代理</strong></li><li>keepalived设置双主热备，通过虚拟ip进行访问</li></ul></blockquote><h3 id="6-2-实现步骤"><a href="#6-2-实现步骤" class="headerlink" title="6.2 实现步骤"></a>6.2 实现步骤</h3><h4 id="6-2-1-Haproxy的负载均衡实现"><a href="#6-2-1-Haproxy的负载均衡实现" class="headerlink" title="6.2.1 Haproxy的负载均衡实现"></a>6.2.1 Haproxy的负载均衡实现</h4><blockquote><ul><li><img src="54.png" alt></li><li>三台mysql，一台mycat</li><li><code>scp -r root@192.168.73.130:/opt/mycat</code>复制mycat，将131也设置为mycat，-r为递归</li><li>启动两台主机的mycat</li><li>在132主机安装haproxy，<code>yum serach haproxy</code>——-<code>yum -y install haproxy</code></li><li>配置haproxy配置文件<code>vim /etc/haproxy/haproxy.cfg</code></li><li>mode改为tcp</li><li>关注端口5000</li><li>默认走backend app<br>-负载均衡策略<ul><li>server:名字，ip，端口</li></ul></li></ul></blockquote><blockquote><ul><li><code>haproxy -f /etc/haproxy/haproxy.cfg</code>启动</li><li><img src="55.png" alt></li><li>navicat中连接haproxy，密码为mycat的密码，可成功登录。</li></ul><p><em>到此完成负载均衡</em></p></blockquote><h4 id="6-2-2-keepalived部署"><a href="#6-2-2-keepalived部署" class="headerlink" title="6.2.2 keepalived部署"></a>6.2.2 keepalived部署</h4><blockquote><ul><li>130主机 <code>yum install -y haproxy</code></li><li><img src="56.png" alt></li><li><img src="57.png" alt></li></ul><p><em>此时主机130、132部署haproxy，全都做了负载均衡，映射130与131上的8066端口，即mycat，两台mycat配置相同，即具有相同的读写库设置与分片原理</em></p><ul><li><code>yum search keepalived</code>进行搜索；<code>yum install -y keepalived</code>进行安装</li><li><code>vim /etc/keepalived/keepalived.conf</code></li><li>进行配置<br><img src="58.png" alt><br><img src="59.png" alt="网卡要改，在ip addr里查看，通常是ens33"><br><img src="60.png" alt><ul><li>要将ssl改为tcp检查</li><li>一台keepalived对应一台haproxy，因此配置好虚拟ip后，只需要在虚拟ip配置里配置一台real_server</li></ul></li><li>同理在132也安装keepalived，conf文件可以直接从130复制</li><li>两台主机启动keepalived<code>keepalived -f /etc/keepalived/keepalived.conf</code></li><li><code>ps -ef|grep keepalived</code>查看进程</li><li>此时使用ip addr便可查看到，130的ens33网卡对应两个ip，一个是自身的130，一个是keepalived的虚拟ip，而132则只有一个</li><li>navicat 连接虚拟ip，密码为mycat密码，端口为自己设定的端口，访问成功！</li><li>当130的keepalived挂掉之后，132则会开启，网卡中的映射增加一个虚拟ip；130重新开启后，虚拟ip也依然绑定的是132，不会变动</li><li>但当把132的haproxy 关闭后，keepalived并没有切换。出问题了！！！</li><li>解决：<ul><li>conf文件中删掉对应的tcp_check，这玩意没起作用</li><li>写一个vrrp_script chk_haproxy{}<ul><li><code>kill -0 haproxy</code>如果haproxy正常返回0，宕机返回1（返回值可用<code>echo $?</code>进行查看）</li><li>没有此命令的话<code>yum search killall</code>—–<code>yum install psmisc.x86_64</code></li></ul></li><li><img src="61.png" alt="脚本，每两秒执行一次"></li><li><img src="62.png" alt="脚本插入虚拟ip的设置里"></li><li>大括号前要加空格，注意。。</li></ul></li></ul><p><em>至此，haproxy的负载均衡与keepalived的双主热备就介绍完了</em><br><em>mycat部分也告一段落</em></p></blockquote><blockquote><ul><li>一致性哈希</li><li>对于一般电商项目，期待的是每个用户下单，能快速地根据相关表进行查询，并且在统计所有订单时可以轻松的在同一主机上获取，这种情况最好根据用户id进行分片，使用一致性哈希规则。并且为订单表配置相关子表，便于条件查询</li><li><img src="63.png" alt></li><li><img src="64.png" alt></li><li><img src="65.png" alt></li></ul></blockquote><blockquote><p><strong>有喜欢的小伙伴可以多多分享哦</strong><br><strong>欢迎打赏！！！</strong></p></blockquote><p><em>本系列均为原创，如有引用请注明出处，如以本内容获取盈利，本人有法律权益进行相关维权！！</em></p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>脉搏波处理与分析——降噪篇（一）</title>
      <link href="2021/03/28/mai-bo-bo-chu-li-yu-fen-xi-jiang-zao-pian-yi/"/>
      <url>2021/03/28/mai-bo-bo-chu-li-yu-fen-xi-jiang-zao-pian-yi/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li>今天打算开一个系列，属于<strong>信号处理与分析</strong>范畴。</li><li>这是我硕士研究生在读期间总结的一部分，旨在对<strong>脉搏波</strong>进行一个较为完整的分析与处理。</li><li>本系列分为两部分，一部分为<strong>脉搏波数据降噪</strong>，另一部分为<strong>脉搏波特征提取</strong></li><li>希望能给接触到信号分析领域的学弟学妹或者同学提供一个帮助和引导。</li><li>基于语言与工具：Matlab</li><li>针对数据序列：一维</li><li>后面我将会详细介绍我所写的代码对应的功能与对应知识点</li><li>PS：此算法仅针对脉搏波，当然技术与原理是共通的。降噪部分也可以应用到其他信号中去</li></ul></blockquote><h2 id="1-何为脉搏波？"><a href="#1-何为脉搏波？" class="headerlink" title="1. 何为脉搏波？"></a>1. 何为脉搏波？</h2><pre><code>脉搏波的检测起始于我国古代的中医脉诊。在西方医学的诞生前，我国中医便依据经验不断地传承发展下来。形成了自己独有的一套诊疗体系。在中医所说的四诊“望、闻、问、切”中，最为重要的便是“切脉”，所述“切脉”并不为人所常称呼，我们常称其为把脉，凭借的便是医生指下对脉搏的搏动感知，进而对身体情况进行评判。这很难在现代的科学社会所被承认。诚然，中医在历史的医学发展中扮演着不可或缺的一部分，但在其发展过程中，仅凭借医师口口相传，以经验进行教学，每个人的悟法不同，便可得到不同的意思，以此形式发展，必然是不可循证，且无法评判诊疗的正确性和真实性的。因此我们有必要对脉搏进行拆解、去分析。发现不同脉象的规律与判定。</code></pre><h2 id="2-脉搏波长啥样？"><a href="#2-脉搏波长啥样？" class="headerlink" title="2. 脉搏波长啥样？"></a>2. 脉搏波长啥样？</h2><p>随便给大家展示一下：<br><img src="1.png" alt="脉搏波1"></p><blockquote><p>有看清楚吗?<br>包括完整的<strong>波峰</strong>和<strong>波谷</strong>，以及<strong>重搏波</strong>。这肯定就是脉搏波没错了！！<br>如果你那么确定，那再看一张：</p></blockquote><p><img src="2.png" alt="脉搏波2"></p><blockquote><p>您可能要跟我争论了，这tn的也能叫脉搏波？这不就是一个波峰吗<br>您给说对了，这就是只有单波峰的脉搏波。</p></blockquote><blockquote><p>其实脉搏波形状多种多样，每个人的脉搏都会跳动出不同的样子，不同于教科书，就像树叶一样，世界上没有两个相同的脉搏波形。你是唯一且独特的。<br>但其实最标准的脉搏是这个样子的：</p></blockquote><p><img src="3.png" alt="脉搏波"></p><blockquote><p>可以看到正常的脉搏波是由<strong>波谷-&gt;波峰-&gt;波峰谷点-&gt;重搏前波-&gt;重搏波谷-&gt;重搏波-&gt;波谷</strong>所组成的。<br>这个过程对应着<strong>左心室收缩射血-&gt;二尖瓣关闭-&gt;射血结束期-&gt;主动脉瓣关闭</strong>等一系列的过程，如果你对局部解剖学感兴趣，可以看一看心血循环对应的内容。<br>当然以上所述的心血循环过程并不保证顺序正确与内容全面。自己这方面的知识也有所忘记。只是阐述一下相关的过程，等我再次温习的时候会回来进行补充。</p><p>图中的字母含义先在此进行解释：</p><ul><li>a-&gt;脉搏波谷点</li><li>b-&gt;脉搏波波峰</li><li>c-&gt;波峰谷点</li><li>d-&gt;重博前波</li><li>e-&gt;重搏波谷</li><li>f-&gt;重搏波</li><li>g-&gt;下一个周期的脉搏波谷点；即起点   </li><li>h1、h2、h3、h4、h5-&gt;分别对应相应点的高度，即幅值</li><li>t1、t5-&gt;对应相应点所需要的时间</li><li>T-&gt;周期</li></ul><p>当然因为每个人的脉象不同，也就代表了不同的体质。<br>中医医师从脉象中辨别病情，若脉搏波信息可以数字化，以科学的方法做评判会对中医切脉带来莫大的帮助与发展。</p></blockquote><h2 id="3-找不到脉搏波数据？"><a href="#3-找不到脉搏波数据？" class="headerlink" title="3. 找不到脉搏波数据？"></a>3. 找不到脉搏波数据？</h2><blockquote><p>这可能是很多人最苦恼的事情。<br>在读大学的学弟学妹接触此方面数据处理时，总是愁于找不到对应的数据。<br>的确，现在网络上想找到优秀的脉搏波数据库并不容易。心声信号倒是可以查到很多。<br>在此我将给同学们介绍一个对应的脉搏波数据库，直接贴网站：<br><a href="http://www4.comp.polyu.edu.hk/" target="_blank" rel="noopener">http://www4.comp.polyu.edu.hk/</a><br>这是由香港理工大学生物医学工程系团队搭建的数据库。里面包括了很多系列，舌象、指纹、心声、脉搏等等数据库。<br>可以说还是蛮全面的了，我所编写的处理算法就是以此数据进行处理的<br>如果有不会操作的小伙伴可以联系我的邮箱<em><a href="mailto:1192821364@qq.com" target="_blank" rel="noopener">1192821364@qq.com</a></em>或<em><a href="mailto:zhuofengdd@outlook.com" target="_blank" rel="noopener">zhuofengdd@outlook.com</a></em>备注好需求<br>或在评论区留言，我可以以压缩包的方式邮件传送给你。<br>里面的文件全都是 .mat格式，matlab一个简单的语句就可导入：</p><pre class="line-numbers language-matlab"><code class="language-matlab">clc<span class="token punctuation">;</span>clear all<span class="token punctuation">;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'PolyU_Pressure_Pulse.mat'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">%这里的路径写你所存放此文件的路径</span>Fs <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">%MIT数据库心电采样频率为500Hz--------------可调参数-------------</span>patientNum<span class="token operator">=</span><span class="token number">165</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%可设定对应的序号</span>pulseSig <span class="token operator">=</span> <span class="token function">Diabetes</span><span class="token punctuation">(</span>patientNum<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">%--------------可调参数-------------提取对应序号下的脉搏波序列</span>t <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>pulseSig<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%时间序列</span>tx <span class="token operator">=</span> t<span class="token operator">./</span>Fs<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%表示所处时间点位</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>进行绘图</p><pre><code>plot(pulseSig);grid on;title(&#39;原始信号&#39;);</code></pre><p>可看到结果：<br><img src="4.png" alt="165号原始脉搏信息"><br>就是如此简单，拿到脉搏后小伙伴们就可以针对自己的需求做对应的操作了。</p></blockquote><blockquote><p>第一篇介绍到这里暂时告一段落，下一篇将要开始介绍降噪的过程了<br>想到知识点随时补充，欢迎小伙伴们常点击。<br><strong>有喜欢的小伙伴可以多多分享哦</strong><br><strong>欢迎打赏！！！</strong></p></blockquote><p><em>本系列均为原创，如有引用请注明出处，如以本内容获取盈利，本人有法律权益进行相关维权！！</em></p>]]></content>
      
      
      <categories>
          
          <category> 信号处理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脉搏波 </tag>
            
            <tag> 降噪 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ基础</title>
      <link href="2021/03/27/rabbitmq-ji-chu/"/>
      <url>2021/03/27/rabbitmq-ji-chu/</url>
      
        <content type="html"><![CDATA[<h1 id="RabbitMQ-实战教程"><a href="#RabbitMQ-实战教程" class="headerlink" title="RabbitMQ 实战教程"></a>RabbitMQ 实战教程</h1><h2 id="1-MQ引言"><a href="#1-MQ引言" class="headerlink" title="1.MQ引言"></a>1.MQ引言</h2><h3 id="1-1-什么是MQ"><a href="#1-1-什么是MQ" class="headerlink" title="1.1 什么是MQ"></a>1.1 什么是MQ</h3><p><code>MQ</code>(Message Quene) :  翻译为 <code>消息队列</code>,通过典型的 <code>生产者</code>和<code>消费者</code>模型,生产者不断向消息队列中生产消息，消费者不断的从队列中获取消息。因为消息的生产和消费都是异步的，而且只关心消息的发送和接收，没有业务逻辑的侵入,轻松的实现系统间解耦。别名为 <code>消息中间件</code>    通过利用高效可靠的消息传递机制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。</p><h3 id="1-2-MQ有哪些"><a href="#1-2-MQ有哪些" class="headerlink" title="1.2 MQ有哪些"></a>1.2 MQ有哪些</h3><p>当今市面上有很多主流的消息中间件，如老牌的<code>ActiveMQ</code>、<code>RabbitMQ</code>，炙手可热的<code>Kafka</code>，阿里巴巴自主开发<code>RocketMQ</code>等。</p><h3 id="1-3-不同MQ特点"><a href="#1-3-不同MQ特点" class="headerlink" title="1.3 不同MQ特点"></a>1.3 不同MQ特点</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.ActiveMQ</span><span class="token code keyword">        ActiveMQ 是Apache出品，最流行的，能力强劲的开源消息总线。它是一个完全支持JMS规范的的消息中间件。丰富的API,多种集群架构模式让ActiveMQ在业界成为老牌的消息中间件,在中小型企业颇受欢迎!</span><span class="token title important"><span class="token punctuation">#</span> 2.Kafka</span><span class="token code keyword">        Kafka是LinkedIn开源的分布式发布-订阅消息系统，目前归属于Apache顶级项目。Kafka主要特点是基于Pull的模式来处理消息消费，</span><span class="token code keyword">        追求高吞吐量，一开始的目的就是用于日志收集和传输。0.8版本开始支持复制，不支持事务，对消息的重复、丢失、错误没有严格要求，</span><span class="token code keyword">        适合产生大量数据的互联网服务的数据收集业务。</span><span class="token title important"><span class="token punctuation">#</span> 3.RocketMQ</span><span class="token code keyword">        RocketMQ是阿里开源的消息中间件，它是纯Java开发，具有高吞吐量、高可用性、适合大规模分布式系统应用的特点。RocketMQ思路起</span><span class="token code keyword">        源于Kafka，但并不是Kafka的一个Copy，它对消息的可靠传输及事务性做了优化，目前在阿里集团被广泛应用于交易、充值、流计算、消</span><span class="token code keyword">        息推送、日志流式处理、binglog分发等场景。</span><span class="token title important"><span class="token punctuation">#</span> 4.RabbitMQ</span><span class="token code keyword">        RabbitMQ是使用Erlang语言开发的开源消息队列系统，基于AMQP协议来实现。AMQP的主要特征是面向消息、队列、路由（包括点对点和</span><span class="token code keyword">        发布/订阅）、可靠性、安全。AMQP协议更多用在企业系统内对数据一致性、稳定性和可靠性要求很高的场景，对性能和吞吐量的要求还在</span><span class="token code keyword">        其次。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>RabbitMQ比Kafka可靠，Kafka更适合IO高吞吐的处理，一般应用在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）要求稍低的场景使用，比如ELK日志收集。</p></blockquote><hr><h2 id="2-RabbitMQ-的引言"><a href="#2-RabbitMQ-的引言" class="headerlink" title="2.RabbitMQ 的引言"></a>2.RabbitMQ 的引言</h2><h3 id="2-1-RabbitMQ"><a href="#2-1-RabbitMQ" class="headerlink" title="2.1 RabbitMQ"></a>2.1 RabbitMQ</h3><blockquote><p>基于<code>AMQP</code>协议，erlang语言开发，是部署最广泛的开源消息中间件,是最受欢迎的开源消息中间件之一。</p></blockquote><p><img src="image-20190925215603036-9419777.png" alt></p><p><code>官网</code>: <a href="https://www.rabbitmq.com/" target="_blank" rel="noopener">https://www.rabbitmq.com/</a></p><p><code>官方教程</code>: <a href="https://www.rabbitmq.com/#getstarted" target="_blank" rel="noopener">https://www.rabbitmq.com/#getstarted</a></p><pre class="line-numbers language-markdown"><code class="language-markdown"> <span class="token title important"><span class="token punctuation">#</span> AMQP 协议</span><span class="token code keyword">         AMQP（advanced message queuing protocol）`在2003年时被提出，最早用于解决金融领不同平台之间的消息传递交互问题。顾名思义，AMQP是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和JMS的本质差别，AMQP不从API层进行限定，而是直接定义网络交换的数据格式。这使得实现了AMQP的provider天然性就是跨平台的。以下是AMQP协议模型:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="image-20200311182438041.png" alt></p><h3 id="2-2-RabbitMQ-的安装"><a href="#2-2-RabbitMQ-的安装" class="headerlink" title="2.2 RabbitMQ 的安装"></a>2.2 RabbitMQ 的安装</h3><h4 id="2-2-1-下载"><a href="#2-2-1-下载" class="headerlink" title="2.2.1 下载"></a>2.2.1 下载</h4><p><code>官网下载地址</code>: <a href="https://www.rabbitmq.com/download.html![](image-20190925220115235.png)" target="_blank" rel="noopener">https://www.rabbitmq.com/download.html![](image-20190925220115235.png)</a></p><blockquote><p><code>最新版本</code>: 3.7.18</p></blockquote><h4 id="2-2-2-下载的安装包"><a href="#2-2-2-下载的安装包" class="headerlink" title="2.2.2 下载的安装包"></a>2.2.2 下载的安装包<img src="image-20190925220343521.png" alt></h4><blockquote><p><code>注意</code>:这里的安装包是centos7安装的包</p></blockquote><h4 id="2-2-3-安装步骤"><a href="#2-2-3-安装步骤" class="headerlink" title="2.2.3 安装步骤"></a>2.2.3 安装步骤</h4><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.将rabbitmq安装包上传到linux系统中</span><span class="token code keyword">    erlang-22.0.7-1.el7.x86_64.rpm</span><span class="token code keyword">    rabbitmq-server-3.7.18-1.el7.noarch.rpm</span><span class="token title important"><span class="token punctuation">#</span> 2.安装Erlang依赖包</span><span class="token code keyword">    rpm -ivh erlang-22.0.7-1.el7.x86_64.rpm</span><span class="token title important"><span class="token punctuation">#</span> 3.安装RabbitMQ安装包(需要联网)</span><span class="token code keyword">    yum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm</span><span class="token code keyword">        注意:默认安装完成后配置文件模板在:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example目录中,需要    </span><span class="token code keyword">                将配置文件复制到/etc/rabbitmq/目录中,并修改名称为rabbitmq.config</span><span class="token title important"><span class="token punctuation">#</span> 4.复制配置文件</span><span class="token code keyword">    cp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</span><span class="token title important"><span class="token punctuation">#</span> 5.查看配置文件位置</span><span class="token code keyword">    ls /etc/rabbitmq/rabbitmq.config</span><span class="token title important"><span class="token punctuation">#</span> 6.修改配置文件(参见下图:)</span><span class="token code keyword">    vim /etc/rabbitmq/rabbitmq.config </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20190925222230260-3836271.png" alt></p><p>将上图中配置文件中红色部分去掉<code>%%</code>,以及最后的<code>,</code>逗号 修改为下图:</p><p><img src="image-20190925222329200-3836312.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 7.执行如下命令,启动rabbitmq中的插件管理</span><span class="token code keyword">    rabbitmq-plugins enable rabbitmq_management</span><span class="token code keyword">    出现如下说明:</span><span class="token code keyword">        Enabling plugins on node rabbit@localhost:</span><span class="token code keyword">    rabbitmq_management</span><span class="token code keyword">    The following plugins have been configured:</span><span class="token code keyword">      rabbitmq_management</span><span class="token code keyword">      rabbitmq_management_agent</span><span class="token code keyword">      rabbitmq_web_dispatch</span><span class="token code keyword">    Applying plugin configuration to rabbit@localhost...</span><span class="token code keyword">    The following plugins have been enabled:</span><span class="token code keyword">      rabbitmq_management</span><span class="token code keyword">      rabbitmq_management_agent</span><span class="token code keyword">      rabbitmq_web_dispatch</span><span class="token code keyword">    set 3 plugins.</span><span class="token code keyword">    Offline change; changes will take effect at broker restart.</span><span class="token title important"><span class="token punctuation">#</span> 8.启动RabbitMQ的服务</span><span class="token code keyword">    systemctl start rabbitmq-server</span><span class="token code keyword">    systemctl restart rabbitmq-server</span><span class="token code keyword">    systemctl stop rabbitmq-server</span><span class="token title important"><span class="token punctuation">#</span> 9.查看服务状态(见下图:)</span><span class="token code keyword">    systemctl status rabbitmq-server</span>  ● rabbitmq-server.service - RabbitMQ broker<span class="token code keyword">     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)</span><span class="token code keyword">     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago</span>   Main PID: 2904 (beam.smp)<span class="token code keyword">     Status: "Initialized"</span><span class="token code keyword">     CGroup: /system.slice/rabbitmq-server.service</span><span class="token code keyword">             ├─2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -</span><span class="token code keyword">             MBlmbcs...</span><span class="token code keyword">             ├─3220 erl_child_setup 32768</span><span class="token code keyword">             ├─3243 inet_gethost 4</span><span class="token code keyword">             └─3244 inet_gethost 4</span><span class="token code keyword">      .........</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20190925222743776-3836511.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 10.关闭防火墙服务</span><span class="token code keyword">    systemctl disable firewalld</span><span class="token code keyword">    Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><span class="token code keyword">    Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><span class="token code keyword">    systemctl stop firewalld   </span><span class="token title important"><span class="token punctuation">#</span> 11.访问web管理界面</span><span class="token code keyword">    http://10.15.0.8:15672/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <img src="image-20190926194738708-3836601.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 12.登录管理界面</span><span class="token code keyword">    username:  guest</span><span class="token code keyword">    password:  guest</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="image-20190926194954822-3836665.png" alt></p><hr><h2 id="3-RabiitMQ-配置"><a href="#3-RabiitMQ-配置" class="headerlink" title="3. RabiitMQ 配置"></a>3. RabiitMQ 配置</h2><h3 id="3-1RabbitMQ-管理命令行"><a href="#3-1RabbitMQ-管理命令行" class="headerlink" title="3.1RabbitMQ 管理命令行"></a>3.1RabbitMQ 管理命令行</h3><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.服务启动相关</span><span class="token code keyword">    systemctl start|restart|stop|status rabbitmq-server</span><span class="token title important"><span class="token punctuation">#</span> 2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ</span><span class="token code keyword">    rabbitmqctl  help  可以查看更多命令</span><span class="token title important"><span class="token punctuation">#</span> 3.插件管理命令行</span><span class="token code keyword">    rabbitmq-plugins enable|list|disable </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-web管理界面介绍"><a href="#3-2-web管理界面介绍" class="headerlink" title="3.2 web管理界面介绍"></a>3.2 web管理界面介绍</h3><h4 id="3-2-1-overview概览"><a href="#3-2-1-overview概览" class="headerlink" title="3.2.1 overview概览"></a>3.2.1 overview概览</h4><p><img src="image-20191126162026720.png" alt></p><ul><li><p><code>connections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才可以完成消息的生产和消费，在这里可以查看连接情况</code></p></li><li><p><code>channels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。</code></p></li><li><p><code>Exchanges：交换机，用来实现消息的路由</code></p></li><li><p><code>Queues：队列，即消息队列，消息存放在队列中，等待消费，消费后被移除队列。</code></p></li></ul><h4 id="3-2-2-Admin用户和虚拟主机管理"><a href="#3-2-2-Admin用户和虚拟主机管理" class="headerlink" title="3.2.2 Admin用户和虚拟主机管理"></a>3.2.2 Admin用户和虚拟主机管理</h4><h5 id="1-添加用户"><a href="#1-添加用户" class="headerlink" title="1. 添加用户"></a>1. 添加用户</h5><p><img src="/image-20191126162617280.png" alt></p><p>上面的Tags选项，其实是指定用户的角色，可选的有以下几个：</p><ul><li><p><code>超级管理员(administrator)</code></p><p>可登陆管理控制台，可查看所有的信息，并且可以对用户，策略(policy)进行操作。</p></li><li><p><code>监控者(monitoring)</code></p><p>可登陆管理控制台，同时可以查看rabbitmq节点的相关信息(进程数，内存使用情况，磁盘使用情况等)</p></li><li><p><code>策略制定者(policymaker)</code></p><p>可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的相关信息(上图红框标识的部分)。</p></li><li><p><code>普通管理者(management)</code></p><p>仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。</p></li><li><p><code>其他</code></p><p>无法登陆管理控制台，通常就是普通的生产者和消费者。</p></li></ul><h5 id="2-创建虚拟主机"><a href="#2-创建虚拟主机" class="headerlink" title="2. 创建虚拟主机"></a>2. 创建虚拟主机</h5><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 虚拟主机</span><span class="token code keyword">    为了让各个用户可以互不干扰的工作，RabbitMQ添加了虚拟主机（Virtual Hosts）的概念。其实就是一个独立的访问路径，不同用户使用不同路径，各自有自己的队列、交换机，互相不会影响。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> <img src="image-20191126163023153.png" alt></p><h5 id="3-绑定虚拟主机和用户"><a href="#3-绑定虚拟主机和用户" class="headerlink" title="3. 绑定虚拟主机和用户"></a>3. 绑定虚拟主机和用户</h5><p>创建好虚拟主机，我们还要给用户添加访问权限：</p><p>点击添加好的虚拟主机：</p><p> <img src="image-20191126163506795.png" alt></p><p>进入虚拟机设置界面:</p><p><img src="image-20191126163631889.png" alt></p><hr><h2 id="4-RabbitMQ-的第一个程序"><a href="#4-RabbitMQ-的第一个程序" class="headerlink" title="4.RabbitMQ 的第一个程序"></a>4.RabbitMQ 的第一个程序</h2><h3 id="4-0-AMQP协议的回顾"><a href="#4-0-AMQP协议的回顾" class="headerlink" title="4.0 AMQP协议的回顾"></a>4.0 AMQP协议的回顾</h3><p><img src="image-20200312140114784.png" alt></p><h3 id="4-1-RabbitMQ支持的消息模型"><a href="#4-1-RabbitMQ支持的消息模型" class="headerlink" title="4.1 RabbitMQ支持的消息模型"></a>4.1 RabbitMQ支持的消息模型</h3><p><img src="image-20191126165434784.png" alt></p><p><img src="image-20191126165459282.png" alt></p><h3 id="4-2-引入依赖"><a href="#4-2-引入依赖" class="headerlink" title="4.2 引入依赖"></a>4.2 引入依赖</h3><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-3-第一种模型-直连"><a href="#4-3-第一种模型-直连" class="headerlink" title="4.3 第一种模型(直连)"></a>4.3 第一种模型(直连)</h3><p><img src="image-20191126165840602.png" alt></p><p>在上图的模型中，有以下概念：</p><ul><li>P：生产者，也就是要发送消息的程序</li><li>C：消费者：消息的接受者，会一直等待消息到来。</li><li>queue：消息队列，图中红色部分。类似一个邮箱，可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。</li></ul><h5 id="1-开发生产者"><a href="#1-开发生产者" class="headerlink" title="1. 开发生产者"></a>1. 开发生产者</h5><pre class="line-numbers language-java"><code class="language-java">  <span class="token comment" spellcheck="true">//创建连接工厂</span>  ConnectionFactory connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"10.15.0.9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"ems"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/ems"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Connection connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//创建通道</span>  Channel channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//参数1: 是否持久化  参数2:是否独占队列 参数3:是否自动删除  参数4:其他属性</span>  channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>  channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span><span class="token string">"hello rabbitmq"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-开发消费者"><a href="#2-开发消费者" class="headerlink" title="2. 开发消费者"></a>2. 开发消费者</h5><pre class="line-numbers language-java"><code class="language-java">  <span class="token comment" spellcheck="true">//创建连接工厂</span>  ConnectionFactory connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"10.15.0.9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"ems"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  connectionFactory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/ems"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Connection connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Channel channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>  channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-参数的说明"><a href="#3-参数的说明" class="headerlink" title="3. 参数的说明"></a>3. 参数的说明</h5><pre class="line-numbers language-java"><code class="language-java">  channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token string">'参数1'</span><span class="token operator">:</span>用来声明通道对应的队列  <span class="token string">'参数2'</span><span class="token operator">:</span>用来指定是否持久化队列  <span class="token string">'参数3'</span><span class="token operator">:</span>用来指定是否独占队列  <span class="token string">'参数4'</span><span class="token operator">:</span>用来指定是否自动删除队列  <span class="token string">'参数5'</span><span class="token operator">:</span>对队列的额外配置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="4-4-第二种模型-work-quene"><a href="#4-4-第二种模型-work-quene" class="headerlink" title="4.4 第二种模型(work quene)"></a>4.4 第二种模型(work quene)</h3><p><code>Work queues</code>，也被称为（<code>Task queues</code>），任务模型。当消息处理比较耗时的时候，可能生产消息的速度会远远大于消息的消费速度。长此以往，消息就会堆积越来越多，无法及时处理。此时就可以使用work 模型：<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong>。队列中的消息一旦消费，就会消失，因此任务是不会被重复执行的。</p><p><img src="image-20200314221002008.png" alt></p><p>角色：</p><ul><li>P：生产者：任务的发布者</li><li>C1：消费者-1，领取任务并且完成任务，假设完成速度较慢</li><li>C2：消费者-2：领取任务并完成任务，假设完成速度快</li></ul><h5 id="1-开发生产者-1"><a href="#1-开发生产者-1" class="headerlink" title="1. 开发生产者"></a>1. 开发生产者</h5><pre class="line-numbers language-java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">"====>:我是消息"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-开发消费者-1"><a href="#2-开发消费者-1" class="headerlink" title="2.开发消费者-1"></a>2.开发消费者-1</h5><pre class="line-numbers language-java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-开发消费者-2"><a href="#3-开发消费者-2" class="headerlink" title="3.开发消费者-2"></a>3.开发消费者-2</h5><pre class="line-numbers language-java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//处理消息比较慢 一秒处理一个消息</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者2: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-测试结果"><a href="#4-测试结果" class="headerlink" title="4.测试结果"></a>4.测试结果</h5><p><img src="image-20200314223242058.png" alt></p><p><img src="image-20200314223302207.png" alt></p><blockquote><p><code>总结:默认情况下，RabbitMQ将按顺序将每个消息发送给下一个使用者。平均而言，每个消费者都会收到相同数量的消息。这种分发消息的方式称为循环。</code></p></blockquote><h5 id="5-消息自动确认机制"><a href="#5-消息自动确认机制" class="headerlink" title="5.消息自动确认机制"></a>5.消息自动确认机制</h5><blockquote><p>Doing a task can take a few seconds. You may wonder what happens if one of the consumers starts a long task and dies with it only partly done. With our current code, once RabbitMQ delivers a message to the consumer it immediately marks it for deletion. In this case, if you kill a worker we will lose the message it was just processing. We’ll also lose all the messages that were dispatched to this particular worker but were not yet handled.</p><p>But we don’t want to lose any tasks. If a worker dies, we’d like the task to be delivered to another worker.</p></blockquote><pre class="line-numbers language-java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//一次只接受一条未确认的消息</span><span class="token comment" spellcheck="true">//参数2:关闭自动确认消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>envelope<span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//手动确认消息</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>设置通道一次只能消费一个消息</p></li><li><p>关闭消息的自动确认,开启手动确认消息</p><p><img src="image-20200314230412178.png" alt></p><p><img src="image-20200314230423280.png" alt></p></li></ul><hr><h3 id="4-5-第三种模型-fanout"><a href="#4-5-第三种模型-fanout" class="headerlink" title="4.5 第三种模型(fanout)"></a>4.5 第三种模型(fanout)</h3><p><code>fanout 扇出 也称为广播</code></p><p> <img src="image-20191126213115873.png" alt></p><p>在广播模式下，消息发送流程是这样的：</p><ul><li>可以有多个消费者</li><li>每个<strong>消费者有自己的queue</strong>（队列）</li><li>每个<strong>队列都要绑定到Exchange</strong>（交换机）</li><li><strong>生产者发送的消息，只能发送到交换机</strong>，交换机来决定要发给哪个队列，生产者无法决定。</li><li>交换机把消息发送给绑定过的所有队列</li><li>队列的消费者都能拿到消息。实现一条消息被多个消费者消费</li></ul><h5 id="1-开发生产者-2"><a href="#1-开发生产者-2" class="headerlink" title="1. 开发生产者"></a>1. 开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//声明交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">"fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//广播 一条消息多个消费者同时消费</span><span class="token comment" spellcheck="true">//发布消息</span>channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span>null<span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-开发消费者-1-1"><a href="#2-开发消费者-1-1" class="headerlink" title="2. 开发消费者-1"></a>2. 开发消费者-1</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//绑定交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">"fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将临时队列绑定exchange</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//处理消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-开发消费者-2-1"><a href="#3-开发消费者-2-1" class="headerlink" title="3. 开发消费者-2"></a>3. 开发消费者-2</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//绑定交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">"fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将临时队列绑定exchange</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//处理消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者2: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-开发消费者-3"><a href="#4-开发消费者-3" class="headerlink" title="4.开发消费者-3"></a>4.开发消费者-3</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//绑定交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">"fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将临时队列绑定exchange</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//处理消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者3: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5-测试结果"><a href="#5-测试结果" class="headerlink" title="5. 测试结果"></a>5. 测试结果</h5><p><img src="image-20200315180653207.png" alt></p><p><img src="image-20200315180708489.png" alt></p><p><img src="image-20200315180728035.png" alt></p><hr><h3 id="4-6-第四种模型-Routing"><a href="#4-6-第四种模型-Routing" class="headerlink" title="4.6 第四种模型(Routing)"></a>4.6 第四种模型(Routing)</h3><h4 id="4-6-1-Routing-之订阅模型-Direct-直连"><a href="#4-6-1-Routing-之订阅模型-Direct-直连" class="headerlink" title="4.6.1 Routing 之订阅模型-Direct(直连)"></a>4.6.1 Routing 之订阅模型-Direct(直连)</h4><p><code>在Fanout模式中，一条消息，会被所有订阅的队列都消费。但是，在某些场景下，我们希望不同的消息被不同的队列消费。这时就要用到Direct类型的Exchange。</code></p><p> 在Direct模型下：</p><ul><li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个<code>RoutingKey</code>（路由key）</li><li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>。</li><li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的<code>Routing Key</code>进行判断，只有队列的<code>Routingkey</code>与消息的 <code>Routing key</code>完全一致，才会接收到消息</li></ul><p>流程:</p><p><img src="image-20191126220145375.png" alt></p><p>图解：</p><ul><li>P：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。</li><li>X：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列</li><li>C1：消费者，其所在队列指定了需要routing key 为 error 的消息</li><li>C2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息</li></ul><h5 id="1-开发生产者-3"><a href="#1-开发生产者-3" class="headerlink" title="1. 开发生产者"></a>1. 开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//声明交换机  参数1:交换机名称 参数2:交换机类型 基于指令的Routing key转发</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"direct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String key <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//发布消息</span>channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span>null<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"指定的route key"</span><span class="token operator">+</span>key<span class="token operator">+</span><span class="token string">"的消息"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-开发消费者-1-2"><a href="#2-开发消费者-1-2" class="headerlink" title="2.开发消费者-1"></a>2.开发消费者-1</h5><pre class="line-numbers language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//声明交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"direct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//绑定队列和交换机</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"warn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//消费消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-开发消费者-2-2"><a href="#3-开发消费者-2-2" class="headerlink" title="3.开发消费者-2"></a>3.开发消费者-2</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//声明交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"direct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//绑定队列和交换机</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"logs_direct"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//消费消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者2: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-测试生产者发送Route-key为error的消息时"><a href="#4-测试生产者发送Route-key为error的消息时" class="headerlink" title="4.测试生产者发送Route key为error的消息时"></a>4.测试生产者发送Route key为error的消息时</h5><p> <img src="image-20200316102613933.png" alt></p><p> <img src="image-20200316102627912.png" alt></p><h5 id="5-测试生产者发送Route-key为info的消息时"><a href="#5-测试生产者发送Route-key为info的消息时" class="headerlink" title="5.测试生产者发送Route key为info的消息时"></a>5.测试生产者发送Route key为info的消息时</h5><p> <img src="image-20200316102925740.png" alt></p><p> <img src="image-20200316102947326.png" alt></p><hr><h4 id="4-6-2-Routing-之订阅模型-Topic"><a href="#4-6-2-Routing-之订阅模型-Topic" class="headerlink" title="4.6.2 Routing 之订阅模型-Topic"></a>4.6.2 Routing 之订阅模型-Topic</h4><p><code>Topic</code>类型的<code>Exchange</code>与<code>Direct</code>相比，都是可以根据<code>RoutingKey</code>把消息路由到不同的队列。只不过<code>Topic</code>类型<code>Exchange</code>可以让队列在绑定<code>Routing key</code> 的时候使用通配符！这种模型<code>Routingkey</code> 一般都是由一个或多个单词组成，多个单词之间以”.”分割，例如： <code>item.insert</code></p><p><img src="image-20191127121900255.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 统配符</span><span class="token code keyword">        * (star) can substitute for exactly one word.    匹配不多不少恰好1个词</span><span class="token code keyword">        # (hash) can substitute for zero or more words.  匹配一个或多个词</span><span class="token title important"><span class="token punctuation">#</span> 如:</span><span class="token code keyword">        audit.#    匹配audit.irs.corporate或者 audit.irs 等</span><span class="token code keyword">    audit.*   只能匹配 audit.irs</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="1-开发生产者-4"><a href="#1-开发生产者-4" class="headerlink" title="1.开发生产者"></a>1.开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//生命交换机和交换机类型 topic 使用动态路由(通配符方式)</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"topic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String routekey <span class="token operator">=</span> <span class="token string">"user.save"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//动态路由key</span><span class="token comment" spellcheck="true">//发布消息</span>channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span>routekey<span class="token punctuation">,</span>null<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"这是路由中的动态订阅模型,route key: ["</span><span class="token operator">+</span>routekey<span class="token operator">+</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-开发消费者-1-3"><a href="#2-开发消费者-1-3" class="headerlink" title="2.开发消费者-1"></a>2.开发消费者-1</h5><p><code>Routing Key中使用*通配符方式</code></p><pre class="line-numbers language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//声明交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"topic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//绑定队列与交换机并设置获取交换机中动态路由</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"user.*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//消费消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-开发消费者-2-3"><a href="#3-开发消费者-2-3" class="headerlink" title="3.开发消费者-2"></a>3.开发消费者-2</h5><p><code>Routing Key中使用#通配符方式</code></p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//声明交换机</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"topic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//创建临时队列</span>String queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//绑定队列与交换机并设置获取交换机中动态路由</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"user.#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//消费消息</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span>String consumerTag<span class="token punctuation">,</span> Envelope envelope<span class="token punctuation">,</span> AMQP<span class="token punctuation">.</span>BasicProperties properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者2: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-测试结果-1"><a href="#4-测试结果-1" class="headerlink" title="4.测试结果"></a>4.测试结果</h5><p> <img src="image-20200316113935785.png" alt></p><p> <img src="image-20200316114000459.png" alt></p><h2 id="5-SpringBoot中使用RabbitMQ"><a href="#5-SpringBoot中使用RabbitMQ" class="headerlink" title="5. SpringBoot中使用RabbitMQ"></a>5. SpringBoot中使用RabbitMQ</h2><h3 id="5-0-搭建初始环境"><a href="#5-0-搭建初始环境" class="headerlink" title="5.0 搭建初始环境"></a>5.0 搭建初始环境</h3><h5 id="1-引入依赖"><a href="#1-引入依赖" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h5><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-配置配置文件"><a href="#2-配置配置文件" class="headerlink" title="2. 配置配置文件"></a>2. 配置配置文件</h5><pre class="line-numbers language-yml"><code class="language-yml">spring:  application:    name: springboot_rabbitmq  rabbitmq:    host: 10.15.0.9    port: 5672    username: ems    password: 123    virtual-host: /ems<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>RabbitTemplate</code>  用来简化操作     使用时候直接在项目中注入即可使用</p><h3 id="5-1-第一种hello-world模型使用"><a href="#5-1-第一种hello-world模型使用" class="headerlink" title="5.1 第一种hello world模型使用"></a>5.1 第一种hello world模型使用</h3><ol><li><h5 id="开发生产者"><a href="#开发生产者" class="headerlink" title="开发生产者"></a>开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> RabbitTemplate rabbitTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><h5 id="开发消费者"><a href="#开发消费者" class="headerlink" title="开发消费者"></a>开发消费者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloCustomer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RabbitHandler</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="5-2-第二种work模型使用"><a href="#5-2-第二种work模型使用" class="headerlink" title="5.2 第二种work模型使用"></a>5.2 第二种work模型使用</h3><ol><li><h5 id="开发生产者-1"><a href="#开发生产者-1" class="headerlink" title="开发生产者"></a>开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> RabbitTemplate rabbitTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"work"</span><span class="token punctuation">,</span><span class="token string">"hello work!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><h5 id="开发消费者-1"><a href="#开发消费者-1" class="headerlink" title="开发消费者"></a>开发消费者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WorkCustomer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">"work"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"work message1 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">"work"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"work message2 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>说明:默认在Spring AMQP实现中Work这种方式就是公平调度,如果需要实现能者多劳需要额外配置</code></p></blockquote></li></ol><h3 id="5-3-Fanout-广播模型"><a href="#5-3-Fanout-广播模型" class="headerlink" title="5.3 Fanout 广播模型"></a>5.3 Fanout 广播模型</h3><ol><li><h5 id="开发生产者-2"><a href="#开发生产者-2" class="headerlink" title="开发生产者"></a>开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> RabbitTemplate rabbitTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFanout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"这是日志广播"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ol start="2"><li><h5 id="开发消费者-2"><a href="#开发消费者-2" class="headerlink" title="开发消费者"></a>开发消费者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FanoutCustomer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span>            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"logs"</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">"fanout"</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message1 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//创建临时队列</span>            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"logs"</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">"fanout"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">//绑定交换机类型</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message2 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="5-4-Route-路由模型"><a href="#5-4-Route-路由模型" class="headerlink" title="5.4 Route 路由模型"></a>5.4 Route 路由模型</h3><ol><li><h5 id="开发生产者-3"><a href="#开发生产者-3" class="headerlink" title="开发生产者"></a>开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> RabbitTemplate rabbitTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"directs"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"error 的日志信息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><h5 id="开发消费者-3"><a href="#开发消费者-3" class="headerlink" title="开发消费者"></a>开发消费者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectCustomer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span><span class="token punctuation">{</span>            <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>                    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"info"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"direct"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">"directs"</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message1 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span><span class="token punctuation">{</span>            <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>                    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"direct"</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">"directs"</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message2 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="5-5-Topic-订阅模型-动态路由模型"><a href="#5-5-Topic-订阅模型-动态路由模型" class="headerlink" title="5.5 Topic 订阅模型(动态路由模型)"></a>5.5 Topic 订阅模型(动态路由模型)</h3><ol><li><h5 id="开发生产者-4"><a href="#开发生产者-4" class="headerlink" title="开发生产者"></a>开发生产者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> RabbitTemplate rabbitTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//topic</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"user.save.findAll"</span><span class="token punctuation">,</span><span class="token string">"user.save.findAll 的消息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ol start="2"><li><h5 id="开发消费者-4"><a href="#开发消费者-4" class="headerlink" title="开发消费者"></a>开发消费者</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TopCustomer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>                    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span>                    key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"user.*"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"topic"</span><span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">"topics"</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message1 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>                    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span>                    key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"user.#"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"topic"</span><span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">"topics"</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message2 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr></li></ol><h2 id="6-MQ的应用场景"><a href="#6-MQ的应用场景" class="headerlink" title="6. MQ的应用场景"></a>6. MQ的应用场景</h2><h3 id="6-1-异步处理"><a href="#6-1-异步处理" class="headerlink" title="6.1 异步处理"></a>6.1 异步处理</h3><p><code>场景说明：用户注册后，需要发注册邮件和注册短信,传统的做法有两种 1.串行的方式 2.并行的方式</code></p><ul><li><p><code>串行方式:</code> 将注册信息写入数据库后,发送注册邮件,再发送注册短信,以上三个任务全部完成后才返回给客户端。 这有一个问题是,邮件,短信并不是必须的,它只是一个通知,而这种做法让客户端等待没有必要等待的东西. </p><p><img src="SouthEast-4860248.png" alt></p></li><li><p><code>并行方式:</code>将注册信息写入数据库后,发送邮件的同时,发送短信,以上三个任务完成后,返回给客户端,并行的方式能提高处理的时间。 </p><p><img src="SouthEast-20191127211112660.png" alt></p></li><li><p><code>消息队列:</code>假设三个业务节点分别使用50ms,串行方式使用时间150ms,并行使用时间100ms。虽然并行已经提高的处理时间,但是,前面说过,邮件和短信对我正常的使用网站没有任何影响，客户端没有必要等着其发送完成才显示注册成功,应该是写入数据库后就返回.  <code>消息队列</code>: 引入消息队列后，把发送邮件,短信不是必须的业务逻辑异步处理 </p><p><img src="592892-20190520220249900-1679743651.jpg" alt></p></li></ul><p>由此可以看出,引入消息队列后，用户的响应时间就等于写入数据库的时间+写入消息队列的时间(可以忽略不计),引入消息队列后处理后,响应时间是串行的3倍,是并行的2倍。</p><h3 id="6-2-应用解耦"><a href="#6-2-应用解耦" class="headerlink" title="6.2 应用解耦"></a>6.2 应用解耦</h3><p><code>场景：双11是购物狂节,用户下单后,订单系统需要通知库存系统,传统的做法就是订单系统调用库存系统的接口.</code></p><p> <img src="SouthEast-20191127211247287.png" alt></p><p>这种做法有一个缺点:</p><p>当库存系统出现故障时,订单就会失败。 订单系统和库存系统高耦合.  引入消息队列 </p><p> <img src="SouthEast-20191127211304085.png" alt></p><ul><li><p><code>订单系统:</code>用户下单后,订单系统完成持久化处理,将消息写入消息队列,返回用户订单下单成功。</p></li><li><p><code>库存系统:</code>订阅下单的消息,获取下单消息,进行库操作。  就算库存系统出现故障,消息队列也能保证消息的可靠投递,不会导致消息丢失.</p></li></ul><h3 id="6-3-流量削峰"><a href="#6-3-流量削峰" class="headerlink" title="6.3 流量削峰"></a>6.3 流量削峰</h3><p> <code>场景:</code> 秒杀活动，一般会因为流量过大，导致应用挂掉,为了解决这个问题，一般在应用前端加入消息队列。  </p><p>  <code>作用:</code> </p><p>​            1.可以控制活动人数，超过此一定阀值的订单直接丢弃(我为什么秒杀一次都没有成功过呢^^) </p><p>​            2.可以缓解短时间的高流量压垮应用(应用程序按自己的最大处理能力获取订单) </p><p> <img src="SouthEast-20191127211341601.png" alt></p><p>1.用户的请求,服务器收到之后,首先写入消息队列,加入消息队列长度超过最大值,则直接抛弃用户请求或跳转到错误页面.  </p><p>2.秒杀业务根据消息队列中的请求信息，再做后续处理.</p><hr><h2 id="7-RabbitMQ的集群"><a href="#7-RabbitMQ的集群" class="headerlink" title="7. RabbitMQ的集群"></a>7. RabbitMQ的集群</h2><h3 id="7-1-集群架构"><a href="#7-1-集群架构" class="headerlink" title="7.1 集群架构"></a>7.1 集群架构</h3><h4 id="7-1-1-普通集群-副本集群"><a href="#7-1-1-普通集群-副本集群" class="headerlink" title="7.1.1 普通集群(副本集群)"></a>7.1.1 普通集群(副本集群)</h4><blockquote><p>All data/state required for the operation of a RabbitMQ broker is replicated across all nodes. An exception to this are message queues, which by default reside on one node, though they are visible and reachable from all nodes. To replicate queues across nodes in a cluster   –摘自官网</p></blockquote><p><code>默认情况下:RabbitMQ代理操作所需的所有数据/状态都将跨所有节点复制。这方面的一个例外是消息队列，默认情况下，消息队列位于一个节点上，尽管它们可以从所有节点看到和访问</code></p><ol><li><h5 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h5></li></ol><p><img src="image-20200320094147471.png" alt></p><p>​    核心解决问题:  <code>当集群中某一时刻master节点宕机,可以对Quene中信息,进行备份</code></p><ol start="2"><li><h5 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h5><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 0.集群规划</span><span class="token code keyword">    node1: 10.15.0.3  mq1  master 主节点</span><span class="token code keyword">    node2: 10.15.0.4  mq2  repl1  副本节点</span><span class="token code keyword">    node3: 10.15.0.5  mq3  repl2  副本节点</span><span class="token title important"><span class="token punctuation">#</span> 1.克隆三台机器主机名和ip映射</span><span class="token code keyword">    vim /etc/hosts加入:</span><span class="token code keyword">         10.15.0.3 mq1</span><span class="token code keyword">        10.15.0.4 mq2</span><span class="token code keyword">        10.15.0.5 mq3</span><span class="token code keyword">    node1: vim /etc/hostname 加入:  mq1</span><span class="token code keyword">    node2: vim /etc/hostname 加入:  mq2</span><span class="token code keyword">    node3: vim /etc/hostname 加入:  mq3</span><span class="token title important"><span class="token punctuation">#</span> 2.三个机器安装rabbitmq,并同步cookie文件,在node1上执行:</span><span class="token code keyword">    scp /var/lib/rabbitmq/.erlang.cookie root@mq2:/var/lib/rabbitmq/</span><span class="token code keyword">    scp /var/lib/rabbitmq/.erlang.cookie root@mq3:/var/lib/rabbitmq/</span><span class="token title important"><span class="token punctuation">#</span> 3.查看cookie是否一致:</span><span class="token code keyword">    node1: cat /var/lib/rabbitmq/.erlang.cookie </span><span class="token code keyword">    node2: cat /var/lib/rabbitmq/.erlang.cookie </span><span class="token code keyword">    node3: cat /var/lib/rabbitmq/.erlang.cookie </span><span class="token title important"><span class="token punctuation">#</span> 4.后台启动rabbitmq所有节点执行如下命令,启动成功访问管理界面:</span><span class="token code keyword">    rabbitmq-server -detached </span><span class="token title important"><span class="token punctuation">#</span> 5.在node2和node3执行加入集群命令:</span><span class="token code keyword">    1.关闭       rabbitmqctl stop_app</span><span class="token code keyword">    2.加入集群    rabbitmqctl join_cluster rabbit@mq1</span><span class="token code keyword">    3.启动服务    rabbitmqctl start_app</span><span class="token title important"><span class="token punctuation">#</span> 6.查看集群状态,任意节点执行:</span><span class="token code keyword">    rabbitmqctl cluster_status</span><span class="token title important"><span class="token punctuation">#</span> 7.如果出现如下显示,集群搭建成功:</span><span class="token code keyword">    Cluster status of node rabbit@mq3 ...</span><span class="token code keyword">    [{nodes,[{disc,[rabbit@mq1,rabbit@mq2,rabbit@mq3]}]},</span><span class="token code keyword">    {running_nodes,[rabbit@mq1,rabbit@mq2,rabbit@mq3]},</span><span class="token code keyword">    {cluster_name,&lt;&lt;"rabbit@mq1">>},</span><span class="token code keyword">    {partitions,[]},</span><span class="token code keyword">    {alarms,[{rabbit@mq1,[]},{rabbit@mq2,[]},{rabbit@mq3,[]}]}]</span><span class="token title important"><span class="token punctuation">#</span> 8.登录管理界面,展示如下状态:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="image-20200320095613586.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 9.测试集群在node1上,创建队列</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="image-20200320095743935.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 10.查看node2和node3节点:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="image-20200320095827688.png" alt></p><p><img src="image-20200320095843370.png" alt></p><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 11.关闭node1节点,执行如下命令,查看node2和node3:</span><span class="token code keyword">    rabbitmqctl stop_app</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="image-20200320100000347.png" alt></p><p><img src="image-20200320100010968.png" alt></p><hr></li></ol><h4 id="7-1-2-镜像集群"><a href="#7-1-2-镜像集群" class="headerlink" title="7.1.2 镜像集群"></a>7.1.2 镜像集群</h4><blockquote><p>This guide covers mirroring (queue contents replication) of classic queues  –摘自官网</p><p>By default, contents of a queue within a RabbitMQ cluster are located on a single node (the node on which the queue was declared). This is in contrast to exchanges and bindings, which can always be considered to be on all nodes. Queues can optionally be made <em>mirrored</em> across multiple nodes. –摘自官网</p></blockquote><p><code>镜像队列机制就是将队列在三个节点之间设置主从关系，消息会在三个节点之间进行自动同步，且如果其中一个节点不可用，并不会导致消息丢失或服务不可用的情况，提升MQ集群的整体高可用性。</code></p><ol><li><h5 id="集群架构图"><a href="#集群架构图" class="headerlink" title="集群架构图"></a>集群架构图</h5><p><img src="image-20200320113423235.png" alt></p></li></ol><ol start="2"><li><h5 id="配置集群架构"><a href="#配置集群架构" class="headerlink" title="配置集群架构"></a>配置集群架构</h5><pre class="line-numbers language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 0.策略说明</span><span class="token code keyword">    rabbitmqctl set_policy [-p &lt;vhost>] [--priority &lt;priority>] [--apply-to &lt;apply-to>] &lt;name> &lt;pattern>  &lt;definition></span><span class="token code keyword">    -p Vhost： 可选参数，针对指定vhost下的queue进行设置</span><span class="token code keyword">    Name:     policy的名称</span><span class="token code keyword">    Pattern: queue的匹配模式(正则表达式)</span><span class="token code keyword">    Definition：镜像定义，包括三个部分ha-mode, ha-params, ha-sync-mode</span><span class="token code keyword">                   ha-mode:指明镜像队列的模式，有效值为 all/exactly/nodes</span><span class="token code keyword">                        all：表示在集群中所有的节点上进行镜像</span><span class="token code keyword">                        exactly：表示在指定个数的节点上进行镜像，节点的个数由ha-params指定</span><span class="token code keyword">                        nodes：表示在指定的节点上进行镜像，节点名称通过ha-params指定</span><span class="token code keyword">                 ha-params：ha-mode模式需要用到的参数</span><span class="token code keyword">                ha-sync-mode：进行队列中消息的同步方式，有效值为automatic和manual</span><span class="token code keyword">                priority：可选参数，policy的优先级</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="1-查看当前策略"><a href="#1-查看当前策略" class="headerlink" title="1.查看当前策略"></a>1.查看当前策略</h1><pre><code>   rabbitmqctl list_policies</code></pre><h1 id="2-添加策略"><a href="#2-添加策略" class="headerlink" title="2.添加策略"></a>2.添加策略</h1><pre><code>   rabbitmqctl set_policy ha-all &#39;^hello&#39; &#39;{&quot;ha-mode&quot;:&quot;all&quot;,&quot;ha-sync-mode&quot;:&quot;automatic&quot;}&#39;    说明:策略正则表达式为 “^” 表示所有匹配所有队列名称  ^hello:匹配hello开头队列</code></pre><h1 id="3-删除策略"><a href="#3-删除策略" class="headerlink" title="3.删除策略"></a>3.删除策略</h1><pre><code>   rabbitmqctl clear_policy ha-all</code></pre><h1 id="4-测试集群"><a href="#4-测试集群" class="headerlink" title="4.测试集群"></a>4.测试集群</h1><pre><code>   ----</code></pre>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcode-数组类小结</title>
      <link href="2021/03/27/leetcode-shu-zu-lei-xiao-jie/"/>
      <url>2021/03/27/leetcode-shu-zu-lei-xiao-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="283-移动零点"><a href="#283-移动零点" class="headerlink" title="283    移动零点"></a>283    移动零点</h2><blockquote><p>//Given an array nums, write a function to move all 0’s to the end of it while m<br>//aintaining the relative order of the non-zero elements.<br>//<br>// Example:<br>//<br>//<br>//Input: [0,1,0,3,12]<br>//Output: [1,3,12,0,0]<br>//<br>// Note:<br>//<br>//<br>[// You must do this in-place without making a copy of the array.](// You must do this in-place without making a copy of the array. )<br>// Minimize the total number of operations.<br>// Related Topics 数组 双指针<br>// 👍 734 👎 0</p><p>[解题思路：]</p><ul><li>给定数组，两个指针，分别指向开头和末尾，对应情况分别给出判断和处理流程<ul><li>开头是0，末尾是0</li><li>开头不是零，末尾是0</li><li>开头不是零，末尾不是0</li><li>开头是0，末尾不是0</li></ul></li><li>两个指针指向开始，一个循环遍历，另一个指向非零数应在的位置，遍历结束后后面置0</li></ul></blockquote><pre class="line-numbers language-java"><code class="language-java">方法二：<span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">moveZeroes</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> nonZeroIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">:</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                nums<span class="token punctuation">[</span>nonZeroIndex<span class="token punctuation">]</span> <span class="token operator">=</span> num<span class="token punctuation">;</span>                nonZeroIndex<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span>nonZeroIndex<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度:O(n)<br>空间复杂度:O(1)</p></blockquote><h2 id="566-重塑矩阵"><a href="#566-重塑矩阵" class="headerlink" title="566    重塑矩阵"></a>566    重塑矩阵</h2><blockquote><p>/In MATLAB, there is a very useful function called ‘reshape’, which can reshape<br>// a matrix into a new one with different size but keep its original data.<br>//<br>//<br>//<br>//You’re given a matrix represented by a two-dimensional array, and two positive<br>// integers r and c representing the row number and column number of the wanted re<br>//shaped matrix, respectively.<br>//<br>// The reshaped matrix need to be filled with all the elements of the original m<br>//atrix in the same row-traversing order as they were.<br>//<br>//<br>//<br>//If the ‘reshape’ operation with given parameters is possible and legal, output<br>// the new reshaped matrix; Otherwise, output the original matrix.<br>//<br>//<br>// Example 1:<br>//<br>//Input:<br>//nums =<br>//[[1,2],<br>// [3,4]]<br>//r = 1, c = 4<br>//Output:<br>//[[1,2,3,4]]<br>//Explanation: The row-traversing of nums is [1,2,3,4]. The new reshaped matrix<br>//is a 1 <em> 4 matrix, fill it row by row by using the previous list.<br>//<br>//<br>//<br>// Example 2:<br>//<br>//Input:<br>//nums =<br>//[[1,2],<br>// [3,4]]<br>//r = 2, c = 4<br>//Output:<br>//[[1,2],<br>// [3,4]]<br>//Explanation: There is no way to reshape a 2 </em> 2 matrix to a 2 * 4 matrix. So o<br>//utput the original matrix.<br>//<br>//<br>//<br>// Note:<br>//<br>// The height and width of the given matrix is in range [1, 100].<br>// The given r and c are all positive.<br>//<br>// Related Topics 数组<br>// 👍 136 👎 0</p><p>[解题思路：]</p><p>首先判断如果重塑前后矩阵元素并不符合，直接返回</p></blockquote><pre><code>class Solution {    public int[][] matrixReshape(int[][] nums, int r, int c) {        int m = nums.length,n=nums[0].length;        if (m * n != r * c){            return nums;        }        int index = 0;        int[][] reshapedMatrix = new int[r][c];        for (int i = 0;i&lt;r;i++) {            for (int j = 0;j&lt;c;j++) {                reshapedMatrix[i][j] = nums[index / n][index % n];                index++;            }        }        return reshapedMatrix;    }}</code></pre><blockquote><p>时间复杂度：O(m*n)</p><p>空间复杂度：O(m*n)</p></blockquote><h2 id="485-找出数组最大连续1"><a href="#485-找出数组最大连续1" class="headerlink" title="485    找出数组最大连续1"></a>485    找出数组最大连续1</h2><blockquote><p>//给定一个二进制数组， 计算其中最大连续1的个数。<br>//<br>// 示例 1:<br>//<br>//<br>//输入: [1,1,0,1,1,1]<br>//输出: 3<br>//解释: 开头的两位和最后的三位都是连续1，所以最大连续1的个数是 3.<br>//<br>//<br>// 注意：<br>//<br>//<br>// 输入的数组只包含 0 和1。<br>// 输入数组的长度是正整数，且不超过 10,000。<br>//<br>// Related Topics 数组<br>// 👍 128 👎 0</p><p><a href>解题思路：</a></p><p>两指针，一个指向最大值，一个在遍历中统计当前连续1</p></blockquote><pre><code>class Solution {    public int findMaxConsecutiveOnes(int[] nums) {        int max = 0, cur = 0;        for (int x : nums) {            cur = x == 0 ? 0 : cur + 1;            max = Math.max(max, cur);        }        return max;    }}</code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote><h2 id="240-搜索二维矩阵"><a href="#240-搜索二维矩阵" class="headerlink" title="240    搜索二维矩阵"></a>240    搜索二维矩阵</h2><blockquote><p>//编写一个高效的算法来搜索 m x n 矩阵 matrix 中的一个目标值 target。该矩阵具有以下特性：<br>//<br>//<br>// 每行的元素从左到右升序排列。<br>// 每列的元素从上到下升序排列。<br>//<br>//<br>// 示例:<br>//<br>// 现有矩阵 matrix 如下：<br>//<br>// [<br>//  [1,   4,  7, 11, 15],<br>//  [2,   5,  8, 12, 19],<br>//  [3,   6,  9, 16, 22],<br>//  [10, 13, 14, 17, 24],<br>//  [18, 21, 23, 26, 30]<br>//]<br>//<br>//<br>// 给定 target = 5，返回 true。<br>//<br>// 给定 target = 20，返回 false。<br>// Related Topics 二分查找 分治算法<br>// 👍 446 👎 0<br><a href>解决思路：</a></p><ul><li>对于每一行我们可以像搜索未排序的一维数组——通过检查每个元素来判断是否有目标值。</li><li>矩阵已经排过序，就需要使用二分法搜索以加快我们的算法。</li></ul></blockquote><pre class="line-numbers language-java"><code class="language-java">方法一：<span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">searchMatrix</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> matrix<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> matrix<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(mn)</p><p>空间复杂度：O(1)</p></blockquote><pre class="line-numbers language-java"><code class="language-java">方法二：<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">searchMatrix</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> matrix<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>matrix <span class="token operator">==</span> null <span class="token operator">||</span> matrix<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> m <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length<span class="token punctuation">,</span> n <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> col <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> m <span class="token operator">&amp;&amp;</span> col <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">==</span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span> col<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> row<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(m+n)</p><p>空间复杂度：O(1)</p></blockquote><h2 id="378-有序矩阵的-Kth-Element"><a href="#378-有序矩阵的-Kth-Element" class="headerlink" title="378    有序矩阵的 Kth Element"></a>378    有序矩阵的 Kth Element</h2><blockquote><p>//给定一个 n x n 矩阵，其中每行和每列元素均按升序排序，找到矩阵中第 k 小的元素。<br>//请注意，它是排序后的第 k 小元素，而不是第 k 个不同的元素。<br>//<br>//<br>//<br>// 示例：<br>//<br>// matrix = [<br>//   [ 1,  5,  9],<br>//   [10, 11, 13],<br>//   [12, 13, 15]<br>//],<br>//k = 8,<br>//<br>//返回 13。<br>//<br>//<br>//<br>//<br>// 提示：<br>//你可以假设 k 的值永远是有效的，1 ≤ k ≤ n2 。<br>// Related Topics 堆 二分查找<br>// 👍 439 👎 0</p><p><a href>解决思路：</a></p><ul><li>最直接的做法是将这个二维数组另存为为一维数组，并对该一维数组进行排序。最后这个一维数组中的第 k小个数即为答案。</li><li>二分  由题目给出的性质可知，这个矩阵内的元素是从左上到右下递增的</li></ul><p><a href="https://leetcode-cn.com/problems/kth-smallest-element-in-a-sorted-matrix/solution/you-xu-ju-zhen-zhong-di-kxiao-de-yuan-su-by-leetco/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/kth-smallest-element-in-a-sorted-matrix/solution/you-xu-ju-zhen-zhong-di-kxiao-de-yuan-su-by-leetco/</a></p></blockquote><pre class="line-numbers language-java"><code class="language-java">第一种：<span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">kthSmallest</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> matrix<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> rows <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length<span class="token punctuation">,</span> columns <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sorted <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>rows <span class="token operator">*</span> columns<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> row <span class="token operator">:</span> matrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">:</span> row<span class="token punctuation">)</span> <span class="token punctuation">{</span>                sorted<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> num<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        Arrays<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sorted<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> sorted<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n^2^logn)   对n^2^个数排序</p><p>空间复杂度：O(n^2^)  一维数组</p></blockquote><pre class="line-numbers language-java"><code class="language-java">第二种：<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">kthSmallest</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> matrix<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> m <span class="token operator">=</span> matrix<span class="token punctuation">.</span>length<span class="token punctuation">,</span> n <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">int</span> lo <span class="token operator">=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> hi <span class="token operator">=</span> matrix<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>lo <span class="token operator">&lt;=</span> hi<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> mid <span class="token operator">=</span> lo <span class="token operator">+</span> <span class="token punctuation">(</span>hi <span class="token operator">-</span> lo<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                cnt<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&lt;</span> k<span class="token punctuation">)</span> lo <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> hi <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> lo<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(nlog（r-l）)</p><p>空间复杂度：O(1)</p></blockquote><h2 id="645-错误的集合"><a href="#645-错误的集合" class="headerlink" title="645    错误的集合"></a>645    错误的集合</h2><blockquote><p>//集合 S 包含从1到 n 的整数。不幸的是，因为数据错误，导致集合里面某一个元素复制了成了集合里面的另外一个元素的值，导致集合丢失了一个整数并且有一个元素重<br>//复。<br>//<br>// 给定一个数组 nums 代表了集合 S 发生错误后的结果。你的任务是首先寻找到重复出现的整数，再找到丢失的整数，将它们以数组的形式返回。<br>//<br>// 示例 1:<br>//<br>//<br>//输入: nums = [1,2,2,4]<br>//输出: [2,3]<br>//<br>//<br>// 注意:<br>//<br>//<br>// 给定数组的长度范围是 [2, 10000]。<br>[// 给定的数组是无序的。](// 给定的数组是无序的。)<br>//<br>// Related Topics 哈希表 数学<br>// 👍 125 👎 0</p><p><strong>解决思路：</strong></p><ul><li><p>暴力解法  检查每个数字在数组中出现的次数</p></li><li><p>最直接的方法是先对分解进行排序，这种方法时间复杂度为O（NlogN）。本题可以以O（N）的时间复杂度，O（1）空间复杂度来替代</p></li><li><p>使用 Map</p></li><li><p>使用额外数组，相比map减少了使用空间，使用索引代表key值</p></li><li><p>使用额外空间 ，访问到的数将其值所对应的索引变为负，检查中若哪个索引值将变换两次，此时不变换并记录该重复值，若那个索引不为负数则为缺失值</p></li></ul></blockquote><pre class="line-numbers language-java"><code class="language-java">解法<span class="token number">1</span>：<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findErrorNums</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> dup <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> missing <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> i<span class="token punctuation">)</span>                    count<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>                dup <span class="token operator">=</span> i<span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                missing <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>dup<span class="token punctuation">,</span> missing<span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n^2^)</p><p>空间复杂度：O(1)</p></blockquote><pre class="line-numbers language-java"><code class="language-java">这一版不是很懂<span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findErrorNums</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> i<span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> null<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> tmp <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java"><code class="language-java">解法<span class="token number">3</span>：<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findErrorNums</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Map <span class="token operator">&lt;</span> Integer<span class="token punctuation">,</span> Integer <span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> dup <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> missing <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token operator">:</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>                    dup <span class="token operator">=</span> i<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span>                missing <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>dup<span class="token punctuation">,</span> missing<span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(n)</p></blockquote><pre class="line-numbers language-java"><code class="language-java">解法<span class="token number">4</span>：<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findErrorNums</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>nums<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> dup <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> missing <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            arr<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                missing <span class="token operator">=</span> i<span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>                dup <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>dup<span class="token punctuation">,</span> missing<span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(n)</p></blockquote><pre class="line-numbers language-java"><code class="language-java">方法<span class="token number">5</span>：<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findErrorNums</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> dup <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> missing <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token operator">:</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                dup <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span>                nums<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>                missing <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>dup<span class="token punctuation">,</span> missing<span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote><h2 id="287-寻找重复数"><a href="#287-寻找重复数" class="headerlink" title="287    寻找重复数"></a>287    寻找重复数</h2><blockquote><p>//给定一个包含 n + 1 个整数的数组 nums，其数字都在 1 到 n 之间（包括 1 和 n），可知至少存在一个重复的整数。假设只有一个重复的整数，找出<br>//这个重复的数。<br>//<br>// 示例 1:<br>//<br>// 输入: [1,3,4,2,2]<br>//输出: 2<br>//<br>//<br>// 示例 2:<br>//<br>// 输入: [3,1,3,4,2]<br>//输出: 3<br>//<br>//<br>// 说明：<br>//<br>//<br>[// 不能更改原数组（假设数组是只读的）。<br>// 只能使用额外的 O(1) 的空间。<br>// 时间复杂度小于 O(n2) 。<br>// 数组中只有一个重复的数字，但它可能不止重复出现一次。](// 不能更改原数组（假设数组是只读的）。<br>// 只能使用额外的 O(1) 的空间。<br>// 时间复杂度小于 O(n2) 。<br>// 数组中只有一个重复的数字，但它可能不止重复出现一次。 )<br>//<br>// Related Topics 数组 双指针 二分查找<br>// 👍 891 👎 0</p><p><a href>解题思路：</a></p><ul><li>二分查找：<ul><li>理解：数组包含n+1个整数，都在1-n之间，只有一个重复数，重复次数不清楚</li><li>暴力解法和哈希表解法均不满足条件，要求不能修改数组，也不能使用额外的空间。所以考虑特性</li><li>对数组中出现数字分别统计出现次数，这个次数与重复数的出现有关，</li><li><img src="image-20201007110959566.png" alt="image-20201007110959566" style="zoom:50%;"></li></ul></li><li>快慢指针：暂时不懂</li></ul></blockquote><pre><code>public int findDuplicate(int[] nums) {     int l = 1, h = nums.length - 1;     while (l &lt;= h) {         int mid = l + (h - l) / 2;         int cnt = 0;         for (int i = 0; i &lt; nums.length; i++) {             if (nums[i] &lt;= mid) cnt++;         }         if (cnt &gt; mid) h = mid - 1;         else l = mid + 1;     }     return l;}</code></pre><blockquote><p>时间复杂度：O(nlogn)</p><p>空间复杂度：O(1)</p></blockquote><p>667    优美的排列II</p><blockquote><p>//给定两个整数 n 和 k，你需要实现一个数组，这个数组包含从 1 到 n 的 n 个不同整数，同时满足以下条件：<br>//<br>// ① 如果这个数组是 [a1, a2, a3, … , an] ，那么数组 [|a1 - a2|, |a2 - a3|, |a3 - a4|, …<br>//, |an-1 - an|] 中应该有且仅有 k 个不同整数；.<br>//<br>// ② 如果存在多种答案，你只需实现并返回其中任意一种.<br>//<br>// 示例 1:<br>//<br>//<br>//输入: n = 3, k = 1<br>//输出: [1, 2, 3]<br>//解释: [1, 2, 3] 包含 3 个范围在 1-3 的不同整数， 并且 [1, 1] 中有且仅有 1 个不同整数 : 1<br>//<br>//<br>//<br>//<br>// 示例 2:<br>//<br>//<br>//输入: n = 3, k = 2<br>//输出: [1, 3, 2]<br>//解释: [1, 3, 2] 包含 3 个范围在 1-3 的不同整数， 并且 [2, 1] 中有且仅有 2 个不同整数: 1 和 2<br>//<br>//<br>//<br>//<br>// 提示:<br>//<br>//<br>// n 和 k 满足条件 1 &lt;= k &lt; n &lt;= 104.<br>//<br>//<br>//<br>// Related Topics 数组<br>// 👍 66 👎 0</p><p><a href>解题思路：</a></p><p>让前 k+1 个元素构建出 k 个不相同的差值，序列为：1 k+1 2 k 3 k-1 … k/2 k/2+1.</p></blockquote><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">constructArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ret <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>    ret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> interval <span class="token operator">=</span> k<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> k<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> interval<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> ret<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> interval <span class="token operator">:</span> ret<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> interval<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="697-数组的度"><a href="#697-数组的度" class="headerlink" title="697    数组的度"></a>697    数组的度</h2><blockquote><p>//给定一个非空且只包含非负数的整数数组 nums, 数组的度的定义是指数组里任一元素出现频数的最大值。<br>//<br>// 你的任务是找到与 nums 拥有相同大小的度的最短连续子数组，返回其长度。<br>//<br>// 示例 1:<br>//<br>//<br>//输入: [1, 2, 2, 3, 1]<br>//输出: 2<br>//解释:<br>//输入数组的度是2，因为元素1和2的出现频数最大，均为2.<br>//连续子数组里面拥有相同度的有如下所示:<br>//[1, 2, 2, 3, 1], [1, 2, 2, 3], [2, 2, 3, 1], [1, 2, 2], [2, 2, 3], [2, 2]<br>//最短连续子数组[2, 2]的长度为2，所以返回2.<br>//<br>//<br>// 示例 2:<br>//<br>//<br>//输入: [1,2,2,3,1,4,2]<br>//输出: 6<br>//<br>//<br>// 注意:<br>//<br>//<br>// nums.length 在1到50,000区间范围内。<br>// nums[i] 是一个在0到49,999范围内的整数。<br>//<br>// Related Topics 数组<br>// 👍 172 👎 0</p></blockquote><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">findShortestSubArray</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Map<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> numsCnt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Map<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> numsLastIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Map<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> numsFirstIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> num <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        numsCnt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> numsCnt<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        numsLastIndex<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numsFirstIndex<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            numsFirstIndex<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> maxCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">:</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        maxCnt <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxCnt<span class="token punctuation">,</span> numsCnt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> ret <span class="token operator">=</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> num <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> cnt <span class="token operator">=</span> numsCnt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">!=</span> maxCnt<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        ret <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> numsLastIndex<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">-</span> numsFirstIndex<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="766-托普利兹矩阵"><a href="#766-托普利兹矩阵" class="headerlink" title="766    托普利兹矩阵"></a>766    托普利兹矩阵</h2><blockquote><p>//如果矩阵上每一条由左上到右下的对角线上的元素都相同，那么这个矩阵是 托普利茨矩阵 。<br>//<br>// 给定一个 M x N 的矩阵，当且仅当它是托普利茨矩阵时返回 True。<br>//<br>// 示例 1:<br>//<br>// 输入:<br>//matrix = [<br>//  [1,2,3,4],<br>//  [5,1,2,3],<br>//  [9,5,1,2]<br>//]<br>//输出: True<br>//解释:<br>//在上述矩阵中, 其对角线为:<br>//“[9]”, “[5, 5]”, “[1, 1, 1]”, “[2, 2, 2]”, “[3, 3]”, “[4]”。<br>//各条对角线上的所有元素均相同, 因此答案是True。<br>//<br>//<br>// 示例 2:<br>//<br>// 输入:<br>//matrix = [<br>//  [1,2],<br>//  [2,2]<br>//]<br>//输出: False<br>//解释:<br>//对角线”[1, 2]”上的元素不同。<br>//<br>//<br>// 说明:<br>//<br>//<br>// matrix 是一个包含整数的二维数组。<br>// matrix 的行数和列数均在 [1, 20]范围内。<br>// matrix[i][j] 包含的整数在 [0, 99]范围内。<br>//<br>//<br>// 进阶:<br>//<br>//<br>// 如果矩阵存储在磁盘上，并且磁盘内存是有限的，因此一次最多只能将一行矩阵加载到内存中，该怎么办？<br>// 如果矩阵太大以至于只能一次将部分行加载到内存中，该怎么办？<br>//<br>// Related Topics 数组<br>// 👍 139 👎 0</p><p><a href>解决思路：</a></p><ul><li>对每一斜数列进行检查</li><li>检查左上邻居</li></ul></blockquote><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isToeplitzMatrix</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> matrix<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">check</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> matrix<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">check</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> matrix<span class="token punctuation">,</span> <span class="token keyword">int</span> expectValue<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">>=</span> matrix<span class="token punctuation">.</span>length <span class="token operator">||</span> col <span class="token operator">>=</span> matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>matrix<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">!=</span> expectValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">check</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> expectValue<span class="token punctuation">,</span> row <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> col <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(max(m,n))</p><p>空间复杂度：O(1)</p></blockquote><pre><code>class Solution {    public boolean isToeplitzMatrix(int[][] matrix) {        for (int r = 0; r &lt; matrix.length; ++r)            for (int c = 0; c &lt; matrix[0].length; ++c)                if (r &gt; 0 &amp;&amp; c &gt; 0 &amp;&amp; matrix[r-1][c-1] != matrix[r][c])                    return false;        return true;    }}</code></pre><blockquote><p>时间复杂度：O(m*n)</p><p>空间复杂度：O(1)</p></blockquote><h2 id="565-数组嵌套"><a href="#565-数组嵌套" class="headerlink" title="565    数组嵌套"></a>565    数组嵌套</h2><blockquote><p>//索引从0开始长度为N的数组A，包含0到N - 1的所有整数。找到最大的集合S并返回其大小，其中 S[i] = {A[i], A[A[i]], A[A[A[i<br>//]]], … }且遵守以下的规则。<br>//<br>// 假设选择索引为i的元素A[i]为S的第一个元素，S的下一个元素应该是A[A[i]]，之后是A[A[A[i]]]… 以此类推，不断添加直到S出现重复的元<br>//素。<br>//<br>//<br>//<br>// 示例 1:<br>//<br>// 输入: A = [5,4,0,3,1,6,2]<br>//输出: 4<br>//解释:<br>//A[0] = 5, A[1] = 4, A[2] = 0, A[3] = 3, A[4] = 1, A[5] = 6, A[6] = 2.<br>//<br>//其中一种最长的 S[K]:<br>//S[0] = {A[0], A[5], A[6], A[2]} = {5, 6, 2, 0}<br>//<br>//<br>//<br>//<br>// 提示：<br>//<br>//<br>// N是[1, 20,000]之间的整数。<br>// A中不含有重复的元素。<br>// A中的元素大小在[0, N-1]之间。<br>//<br>// Related Topics 数组<br>// 👍 114 👎 0</p><p><a href>解决思路：</a></p><ul><li>暴力解法：对每个元素，进行循环判断，并以一个count值进行计数，最后判断最大count值</li><li>优化：<ul><li><img src="image-20201008101925655.png" alt="image-20201008101925655" style="zoom:50%;"></li><li>可以看出这些元素的循环判断通路是一样的，这样在遍历时会导致冗余计算，使用boolean数组进行标定</li></ul></li><li>使用数组本身标记访问</li></ul></blockquote><pre><code>public class Solution {    public int arrayNesting(int[] nums) {        int res = 0;        for (int i = 0; i &lt; nums.length; i++) {            int start = nums[i], count = 0;            do {                start = nums[start];                count++;            }            while (start != nums[i]);            res = Math.max(res, count);        }        return res;    }}</code></pre><blockquote><p>时间复杂度：O(n^2^)</p><p>空间复杂度：O(1)</p></blockquote><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">arrayNesting</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> visited <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">boolean</span><span class="token punctuation">[</span>nums<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> start <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">do</span> <span class="token punctuation">{</span>                    start <span class="token operator">=</span> nums<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">;</span>                    count<span class="token operator">++</span><span class="token punctuation">;</span>                    visited<span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(n)</p></blockquote><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">arrayNesting</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            cnt<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> t <span class="token operator">=</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 标记该位置已经被访问</span>            j <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> max<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote><h2 id="769-分隔数组"><a href="#769-分隔数组" class="headerlink" title="769    分隔数组"></a>769    分隔数组</h2><blockquote><p>//数组arr是[0, 1, …, arr.length - 1]的一种排列，我们将这个数组分割成几个“块”，并将这些块分别进行排序。之后再连接起来，使得连<br>//接的结果和按升序排序后的原数组相同。<br>//<br>// 我们最多能将数组分成多少块？<br>//<br>// 示例 1:<br>//<br>// 输入: arr = [4,3,2,1,0]<br>//输出: 1<br>//解释:<br>//将数组分成2块或者更多块，都无法得到所需的结果。<br>//例如，分成 [4, 3], [2, 1, 0] 的结果是 [3, 4, 0, 1, 2]，这不是有序的数组。<br>//<br>//<br>// 示例 2:<br>//<br>// 输入: arr = [1,0,2,3,4]<br>//输出: 4<br>//解释:<br>//我们可以把它分成两块，例如 [1, 0], [2, 3, 4]。<br>//然而，分成 [1, 0], [2], [3], [4] 可以得到最多的块数。<br>//<br>//<br>// 注意:<br>//<br>//<br>// arr 的长度在 [1, 10] 之间。<br>// arr[i]是 [0, 1, …, arr.length - 1]的一种排列。<br>//<br>// Related Topics 数组<br>// 👍 95 👎 0</p><p><a href>解题思路：</a></p><p>遍历数组，统计当前最大值，当此最大值等于其对应所在索引时，则此子数组可以分割为一个块，返回值加1</p></blockquote><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">maxChunksToSorted</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> right <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        right <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">==</span> i<span class="token punctuation">)</span> ret<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>时间复杂度：O(n)</p><p>空间复杂度：O(1)</p></blockquote><h3 id="数组系列二分查找模板"><a href="#数组系列二分查找模板" class="headerlink" title="数组系列二分查找模板"></a>数组系列二分查找模板</h3><blockquote><p><a href>eg:搜索插入位置</a></p><p><img src="image-20201205192228490.png" alt="image-20201205192228490"></p><pre><code>class Solution { public int searchInsert(int[] nums, int target) {     int n=nums.length;     int left=0;int right=n-1;int ans=n;     while(left&lt;=right){         int mid = ((right-left)&gt;&gt;1)+left;         if(target&lt;=nums[mid]){             ans = mid;             right = mid-1;         }else{             left = mid+1;         }     }     return ans; }}</code></pre><p><a href>只要有搜索就可以在数组中使用二分这一方法，具体为对left与right赋值，在循环中添加判断条件，使用mid进行移位控制</a>，框架如下：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">searchInsert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">int</span> n<span class="token operator">=</span>nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span>     <span class="token keyword">int</span> left<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> right<span class="token operator">=</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>     <span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;=</span>right<span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>left<span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">&lt;=</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             right <span class="token operator">=</span> mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>             left <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span>     <span class="token keyword">return</span> left<span class="token punctuation">;</span> <span class="token punctuation">}</span>这种情况可以避免所插数比数组长度处数还要大的情况或者<span class="token keyword">int</span> n<span class="token operator">=</span>nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token keyword">int</span> left<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> right<span class="token operator">=</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">int</span> ans<span class="token operator">=</span>n<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>left<span class="token operator">&lt;</span>right<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>right<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>left<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">&lt;=</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     ans <span class="token operator">=</span> mid<span class="token punctuation">;</span>        right <span class="token operator">=</span> mid<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        left <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>这种情况仅适用于查找已有元素<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个框架直接可以找到你想找的数所在位置，ans即为所指，当没找到想找插入位置时，此框架也可找到其所在位置，只是当所插入位置在数组长度处时，仅在刚开始时赋值给ans即可</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>md文件书写语法</title>
      <link href="2021/03/26/md-wen-jian-shu-xie-yu-fa/"/>
      <url>2021/03/26/md-wen-jian-shu-xie-yu-fa/</url>
      
        <content type="html"><![CDATA[<blockquote><p>花了一天的时间打造了自己的博客，这里是属于自己的小天地，为了更好的做总结和更新博客，这里有必要对Markdown语法进行深入了解</p></blockquote><h2 id="什么是Markdown"><a href="#什么是Markdown" class="headerlink" title="什么是Markdown"></a>什么是Markdown</h2><pre><code>Markdown 是一种轻量级标记语言，创始人为约翰·格鲁伯（John Gruber）。它允许人们「使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档 」—— 维基百科这里不再啰嗦赘述，直接总结知识点。</code></pre><h2 id="标题修饰符"><a href="#标题修饰符" class="headerlink" title="标题修饰符"></a>标题修饰符</h2><pre><code> 也就是所说的大标题，这里标题一共可以分为7级，每多一个“#”符号则向下分散小标题。 如何使用： “# ”既是使用方法，#符号后跟一个空格，接着书写自己的标题内容，此为一级标题。更具体的 “## ”为二级标题 “### ”为三级标题 “#### ”为四级标题 后面的逻辑是一样的。</code></pre><h2 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h2><pre><code>这里所说的有序列表即为有顺序如何使用1. 即数字加.再加一个空格，2. 就是这种效果3. 很简单吧</code></pre><h2 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h2><pre><code>如何使用- 减号加空格+ 加号加空格我比较习惯使用减号，像是在罗列一个列表</code></pre><ul><li>test1</li></ul><ul><li>test2</li></ul><h2 id="引用修饰符"><a href="#引用修饰符" class="headerlink" title="引用修饰符"></a>引用修饰符</h2><pre><code>这个更简单了&gt; 一级引用&gt;&gt; 二级引用&gt;&gt;&gt; 三级引用&gt;&gt;&gt;&gt; 四级引用</code></pre><p>效果如下</p><blockquote><p> 一级引用</p><blockquote><p>二级引用</p><blockquote><p>三级引用</p><blockquote><p>四级引用</p></blockquote></blockquote></blockquote></blockquote><blockquote><p>it’s a test<br>换行了<br>怎么结束呢<br>再多打个换行就可以了，打两下换行</p></blockquote><p>111</p><h2 id="代码修饰符"><a href="#代码修饰符" class="headerlink" title="代码修饰符"></a>代码修饰符</h2><pre><code>简单的，``两个英文反引号就可以将内部包括的代码做代码块包裹,针对于少量代码对于大量代码用``` ```三个反引号</code></pre><p>效果如下：<br><code>i&#39;m spider man</code></p><pre><code>i&#39;m spider man，i&#39;m spider man，i&#39;m spider man</code></pre><h2 id="链接Link"><a href="#链接Link" class="headerlink" title="链接Link"></a>链接Link</h2><pre><code>包括行内式与参数式写法，为方便我会使用行内[](),[]里写文字，()里写链接  [my Blog](https://www.zhuofengdd.top)</code></pre><p>效果如下：<br><a href="https://www.zhuofengdd.top">my Blog</a></p><h2 id="图片插入"><a href="#图片插入" class="headerlink" title="图片插入"></a>图片插入</h2><pre><code>![]()即可![小猪](1.jpg) ()写相对路径</code></pre><p><img src="1.jpg" alt="小猪"></p><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><pre><code>连续三个-或*或_都可以，其实不连续也可以</code></pre><h2 id="效果如下："><a href="#效果如下：" class="headerlink" title="效果如下："></a>效果如下：</h2><hr><hr><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><pre><code>这个代码比较多|title|title|title||:-|:-:|-:|  这里:-为居左，:-:为居中，-:居右|abc|bcd|cde||abc|bcd|cde||abc|bcd|cde|</code></pre><p>效果如下：</p><table><thead><tr><th align="left">title</th><th align="center">title</th><th align="right">title</th></tr></thead><tbody><tr><td align="left">abc</td><td align="center">bcd</td><td align="right">cde</td></tr><tr><td align="left">abc</td><td align="center">bcd</td><td align="right">cde</td></tr><tr><td align="left">abc</td><td align="center">bcd</td><td align="right">cde</td></tr></tbody></table><h2 id="强调"><a href="#强调" class="headerlink" title="强调"></a>强调</h2><pre><code>* 或_包裹起来就可以，一个为斜体两个为加粗*i&#39;m spider man***i&#39;m spider man**_i&#39;m spider man___i&#39;m spider man__</code></pre><p>效果如下：<br><em>i’m spider man</em><br><strong>i’m spider man</strong><br>_i’m spider man_<br><strong>i’m spider man</strong></p><h2 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h2><pre><code>加一个\反斜杠\-\+\*</code></pre><p>-<br>+<br>*</p><h2 id="删除字符"><a href="#删除字符" class="headerlink" title="删除字符"></a>删除字符</h2><pre><code>用~~~~包裹起来两个为一对哦</code></pre><p>效果如下：<br><del>i’m spider man</del></p><p>目前总结这几种简单常用的，学到这基本写博客就没问题了。</p>]]></content>
      
      
      <categories>
          
          <category> 语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> 语法 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
